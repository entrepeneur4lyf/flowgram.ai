"use strict";(self.webpackChunk_flowgram_ai_docs=self.webpackChunk_flowgram_ai_docs||[]).push([["580563"],{733828:function(e,t,n){n.d(t,{oJU:()=>a.oJ,SyX:()=>i.SyX,M1y:()=>i.M1y,Hxo:()=>i.Hxo,tsW:()=>i.tsW,dmf:()=>a.dm,qRT:()=>i.qRT,IxS:()=>tC,n2P:()=>a.n2,JAk:()=>i.JAk,sX$:()=>tV,R6T:()=>i.R6T,Dcz:()=>i.Dcz,iwM:()=>a.iw,GAy:()=>i.GAy,mYg:()=>i.mYg,rVg:()=>i.rVg,LPb:()=>i.LPb,F26:()=>i.F26,EhS:()=>tI,Stp:()=>a.St,C$T:()=>i.C$T,PVB:()=>a.PV,CMu:()=>i.CMu,_J4:()=>i._J4,G2Z:()=>i.G2Z,L4w:()=>a.L4,erw:()=>tB,gNE:()=>i.gNE,gNt:()=>i.gNt}),n("543789");var o,r,i=n("832920"),a=n("682264"),s=n("908600"),l=n("767839"),d=n("229687"),h=n("817750"),c=n("357897"),u=n("213153"),g=n("461932"),p=n("775832"),f=n("215206"),y=n("177783"),m=Object.defineProperty,x=Object.getOwnPropertyDescriptor,v=(e,t,n,o)=>{for(var r=o>1?void 0:o?x(t,n):t,i,a=e.length-1;a>=0;a--)(i=e[a])&&(r=(o?i(t,n,r):i(r))||r);return o&&r&&m(t,n,r),r};(o||(o={})).DEFAULT={canHovered:()=>!0};var b=class extends u.mh{constructor(){super(...arguments),this.nodeTransformsWithSort=[]}autorun(){let{activatedNode:e}=this.selectionService;this.nodeTransformsWithSort=this.nodeTransforms.filter(e=>"root"!==e.entity.id).reverse().sort(t=>t.entity===e?-1:0)}get isDrawing(){return this.linesManager.isDrawing}onReady(){this.options={...o.DEFAULT,...this.options},this.toDispose.pushAll([this.listenPlaygroundEvent("mousemove",e=>{if(this.hoverService.hoveredPos=this.config.getPosFromMouseEvent(e),!this.isEnabled()||!this.options.canHovered(e,this.hoverService))return;let t=this.config.getPosFromMouseEvent(e);this.updateHoveredState(t,e?.target)}),this.selectionService.onSelectionChanged(()=>this.autorun()),this.listenPlaygroundEvent("mousedown",e=>{if(!this.isEnabled()||this.isDrawing)return;let{hoveredNode:t}=this.hoverService;if(t&&t instanceof a.e2)return this.dragService.resetLine(t,e),!0;if(t&&t instanceof a.FD&&"input"!==t.portType&&!t.disabled&&1!==e.button)return e.stopPropagation(),e.preventDefault(),this.dragService.startDrawingLine(t,e),!0;let n=this.config.getPosFromMouseEvent(e),o=function(e,t){let n=e.filter(e=>e instanceof f.GA);return!n?.length||t&&1===n.length&&n[0].childrenLength<=1?y.Ae.EMPTY:y.Ae.enlarge(n.map(e=>e.getData(f.eG).bounds)).pad(2)}(this.selectionService.selection,!0);if(o.width>0&&o.contains(n.x,n.y))return this.dragService.startDragSelectedNodes(e).then(n=>{!n&&(t&&t instanceof a.CT?e.metaKey||e.shiftKey||e.ctrlKey?this.selectionService.toggleSelect(t):this.selectionService.selectNode(t):this.selectionService.clear())}),!0;!t&&this.selectionService.clear()})])}updateHoveredState(e,t){let{hoverService:n}=this,o=this.nodeTransformsWithSort,r=this.linesManager.getPortFromMousePos(e),i=[...this.playgroundNode.querySelectorAll(".gedit-flow-activity-line")].some(e=>e.contains(t));if(r){if("output"===r.portType)n.updateHoveredKey(r.id);else if(i||t?.className?.includes?.("workflow-port-bg")){let t=this.linesManager.getCloseInLineFromMousePos(e);t&&this.updateHoveredKey(t.id)}return}if(this.isDrawing)return;let a=o.find(t=>t.bounds.contains(e.x,e.y))?.entity,s=[...this.playgroundNode.querySelectorAll(".gedit-flow-activity-node")].some(e=>e.contains(t));(a||s)&&a?.id&&this.updateHoveredKey(a.id);let l=!!(a?.parent&&"root"!==a.parent.flowNodeType),d=i?this.linesManager.getCloseInLineFromMousePos(e):void 0,h=!!d?.inContainer;if(a&&l){this.updateHoveredKey(a.id);return}if(d&&h){this.updateHoveredKey(d.id);return}if(a){this.updateHoveredKey(a.id);return}if(d){this.hoverService.updateHoveredKey(d.id);return}n.clearHovered(),this.editorStateConfig.getCurrentState()===u.yy.STATE_MOUSE_FRIENDLY_SELECT&&!this.editorStateConfig.isPressingShift&&this.configEntity.updateCursor("grab")}updateHoveredKey(e){this.configEntity.updateCursor("default"),this.hoverService.updateHoveredKey(e)}isEnabled(){let e=this.editorStateConfig.getCurrentState();return(e===u.yy.STATE_SELECT||e===u.yy.STATE_MOUSE_FRIENDLY_SELECT)&&!this.selectorBoxConfigEntity.isStart&&!this.dragService.isDragging}};b.type="HoverLayer",v([(0,g.f3)(a.L4)],b.prototype,"document",2),v([(0,g.f3)(a.oJ)],b.prototype,"selectionService",2),v([(0,g.f3)(a.iw)],b.prototype,"dragService",2),v([(0,g.f3)(a.XH)],b.prototype,"hoverService",2),v([(0,g.f3)(a.dm)],b.prototype,"linesManager",2),v([(0,u.O0)(u.Zs)],b.prototype,"editorStateConfig",2),v([(0,u.O0)(p.NQ)],b.prototype,"selectorBoxConfigEntity",2),v([(0,g.f3)(u.ER)],b.prototype,"configEntity",2),v([(0,u.aI)(a.CT,f.eG)],b.prototype,"nodeTransforms",2),v([(0,u.RX)(a.e2)],b.prototype,"lines",2),b=v([(0,g.b2)()],b);var E=(0,u.M1)({onInit(e){e.playground.registerLayer(b)}}),w=n("308387"),N=Object.defineProperty,L=Object.getOwnPropertyDescriptor,S=(e,t,n,o)=>{for(var r=o>1?void 0:o?L(t,n):t,i,a=e.length-1;a>=0;a--)(i=e[a])&&(r=(o?i(t,n,r):i(r))||r);return o&&r&&N(t,n,r),r},M=class{constructor(){let e={};e._next=e._prev=e,this._sentinel=e}dequeue(){let e=this._sentinel,t=e._prev;if(t!==e)return k(t),t}enqueue(e){let t=this._sentinel;e._prev&&e._next&&k(e),e._next=t._next,t._next._prev=e,t._next=e,e._prev=t}toString(){let e=[],t=this._sentinel,n=t._prev;for(;n!==t;)e.push(JSON.stringify(n,D)),n=n._prev;return"["+e.join(", ")+"]"}};function k(e){e._prev._next=e._next,e._next._prev=e._prev,delete e._next,delete e._prev}function D(e,t){if("_next"!==e&&"_prev"!==e)return t}var I=()=>1;function C(e,t,n,o,r){let i=r?[]:void 0;return e.inEdges(o.v).forEach(o=>{let a=e.edge(o),s=e.node(o.v);r&&i.push({v:o.v,w:o.w}),s.out-=a,O(t,n,s)}),e.outEdges(o.v).forEach(o=>{let r=e.edge(o),i=o.w,a=e.node(i);a.in-=r,O(t,n,a)}),e.removeNode(o.v),i}function O(e,t,n){n.out?n.in?e[n.out-n.in+t].enqueue(n):e[e.length-1].enqueue(n):e[0].enqueue(n)}var T={addBorderNode:function(e,t,n,o){let r={width:0,height:0};return arguments.length>=4&&(r.rank=n,r.order=o),_(e,"border",r,t)},addDummyNode:_,applyWithChunking:V,asNonCompoundGraph:function(e){let t=new w.Graph({multigraph:e.isMultigraph()}).setGraph(e.graph());return e.nodes().forEach(n=>{!e.children(n).length&&t.setNode(n,e.node(n))}),e.edges().forEach(n=>{t.setEdge(n,e.edge(n))}),t},buildLayerMatrix:function(e){let t=H(B(e)+1).map(()=>[]);return e.nodes().forEach(n=>{let o=e.node(n),r=o.rank;void 0!==r&&(t[r][o.order]=n)}),t},intersectRect:function(e,t){let n,o,r=e.x,i=e.y,a=t.x-r,s=t.y-i,l=e.width/2,d=e.height/2;if(!a&&!s)throw Error("Not possible to find intersection inside of the rectangle");return Math.abs(s)*l>Math.abs(a)*d?(s<0&&(d=-d),n=d*a/s,o=d):(a<0&&(l=-l),n=l,o=l*s/a),{x:r+n,y:i+o}},mapValues:function(e,t){let n=t;return"string"==typeof t&&(n=e=>e[t]),Object.entries(e).reduce((e,[t,o])=>(e[t]=n(o,t),e),{})},maxRank:B,normalizeRanks:P,notime:function(e,t){return t()},partition:function(e,t){let n={lhs:[],rhs:[]};return e.forEach(e=>{t(e)?n.lhs.push(e):n.rhs.push(e)}),n},pick:function(e,t){let n={};for(let o of t)void 0!==e[o]&&(n[o]=e[o]);return n},predecessorWeights:function(e){let t=e.nodes().map(t=>{let n={};return e.inEdges(t).forEach(t=>{n[t.v]=(n[t.v]||0)+e.edge(t).weight}),n});return z(e.nodes(),t)},range:H,removeEmptyRanks:R,simplify:A,successorWeights:function(e){let t=e.nodes().map(t=>{let n={};return e.outEdges(t).forEach(t=>{n[t.w]=(n[t.w]||0)+e.edge(t).weight}),n});return z(e.nodes(),t)},time:function(e,t){let n=Date.now();try{return t()}finally{console.log(e+" time: "+(Date.now()-n)+"ms")}},uniqueId:F,zipObject:z};function _(e,t,n,o){let r;do r=F(o);while(e.hasNode(r));return n.dummy=t,e.setNode(r,n),r}function A(e){let t=new w.Graph().setGraph(e.graph());return e.nodes().forEach(n=>t.setNode(n,e.node(n))),e.edges().forEach(n=>{let o=t.edge(n.v,n.w)||{weight:0,minlen:1},r=e.edge(n);t.setEdge(n.v,n.w,{weight:o.weight+r.weight,minlen:Math.max(o.minlen,r.minlen)})}),t}function P(e){let t=V(Math.min,e.nodes().map(t=>{let n=e.node(t).rank;return void 0===n?Number.MAX_VALUE:n}));e.nodes().forEach(n=>{let o=e.node(n);Object.hasOwn(o,"rank")&&(o.rank-=t)})}function R(e){let t=V(Math.min,e.nodes().map(t=>e.node(t).rank)),n=[];e.nodes().forEach(o=>{let r=e.node(o).rank-t;!n[r]&&(n[r]=[]),n[r].push(o)});let o=0,r=e.graph().nodeRankFactor;Array.from(n).forEach((t,n)=>{void 0===t&&n%r!=0?--o:void 0!==t&&o&&t.forEach(t=>e.node(t).rank+=o)})}var $=65535;function V(e,t){if(!(t.length>$))return e.apply(null,t);{let n=function(e,t=$){let n=[];for(let o=0;o<e.length;o+=t){let r=e.slice(o,o+t);n.push(r)}return n}(t);return e.apply(null,n.map(t=>e.apply(null,t)))}}function B(e){return V(Math.max,e.nodes().map(t=>{let n=e.node(t).rank;return void 0===n?Number.MIN_VALUE:n}))}var j=0;function F(e){var t=++j;return toString(e)+t}function H(e,t,n=1){null==t&&(t=e,e=0);let o=e=>e<t;n<0&&(o=e=>t<e);let r=[];for(let t=e;o(t);t+=n)r.push(t);return r}function z(e,t){return e.reduce((e,n,o)=>(e[n]=t[o],e),{})}var G={run:function(e){("greedy"===e.graph().acyclicer?function(e,t){if(1>=e.nodeCount())return[];let n=function(e,t){let n=new w.Graph,o=0,r=0;e.nodes().forEach(e=>{n.setNode(e,{v:e,in:0,out:0})}),e.edges().forEach(e=>{let i=n.edge(e.v,e.w)||0,a=t(e);n.setEdge(e.v,e.w,i+a),r=Math.max(r,n.node(e.v).out+=a),o=Math.max(o,n.node(e.w).in+=a)});let i=(function(e){let t=[];for(let n=0;n<e;n++)t.push(n);return t})(r+o+3).map(()=>new M),a=o+1;return n.nodes().forEach(e=>{O(i,a,n.node(e))}),{graph:n,buckets:i,zeroIdx:a}}(e,t||I);return(function(e,t,n){let o,r=[],i=t[t.length-1],a=t[0];for(;e.nodeCount();){for(;o=a.dequeue();)C(e,t,n,o);for(;o=i.dequeue();)C(e,t,n,o);if(e.nodeCount()){for(let i=t.length-2;i>0;--i)if(o=t[i].dequeue()){r=r.concat(C(e,t,n,o,!0));break}}}return r})(n.graph,n.buckets,n.zeroIdx).flatMap(t=>e.outEdges(t.v,t.w))}(e,function(e){return t=>e.edge(t).weight}(e)):function(e){let t=[],n={},o={};return e.nodes().forEach(function r(i){if(!Object.hasOwn(o,i))o[i]=!0,n[i]=!0,e.outEdges(i).forEach(e=>{Object.hasOwn(n,e.w)?t.push(e):r(e.w)}),delete n[i]}),t}(e)).forEach(t=>{let n=e.edge(t);e.removeEdge(t),n.forwardName=t.name,n.reversed=!0,e.setEdge(t.w,t.v,n,F("rev"))})},undo:function(e){e.edges().forEach(t=>{let n=e.edge(t);if(n.reversed){e.removeEdge(t);let o=n.forwardName;delete n.reversed,delete n.forwardName,e.setEdge(t.w,t.v,n,o)}})}},W={run:function(e){e.graph().dummyChains=[],e.edges().forEach(t=>(function(e,t){let n,o,r,i=t.v,a=e.node(i).rank,s=t.w,l=e.node(s).rank,d=t.name,h=e.edge(t),c=h.labelRank;if(l!==a+1){for(e.removeEdge(t),r=0,++a;a<l;++r,++a)h.points=[],o={width:0,height:0,edgeLabel:h,edgeObj:t,rank:a},n=T.addDummyNode(e,"edge",o,"_d"),a===c&&(o.width=h.width,o.height=h.height,o.dummy="edge-label",o.labelpos=h.labelpos),e.setEdge(i,n,{weight:h.weight},d),0===r&&e.graph().dummyChains.push(n),i=n;e.setEdge(i,s,{weight:h.weight},d)}})(e,t))},undo:function(e){e.graph().dummyChains.forEach(t=>{let n,o=e.node(t),r=o.edgeLabel;for(e.setEdge(o.edgeObj,r);o.dummy;)n=e.successors(t)[0],e.removeNode(t),r.points.push({x:o.x,y:o.y}),"edge-label"===o.dummy&&(r.x=o.x,r.y=o.y,r.width=o.width,r.height=o.height),t=n,o=e.node(t)})}};function Y(e){var t={};e.sources().forEach(function n(o){var r=e.node(o);if(Object.hasOwn(t,o))return r.rank;t[o]=!0;var i=V(Math.min,e.outEdges(o).map(t=>null==t?Number.POSITIVE_INFINITY:n(t.w)-e.edge(t).minlen));return i===Number.POSITIVE_INFINITY&&(i=0),r.rank=i})}function J(e,t){return e.node(t.w).rank-e.node(t.v).rank-e.edge(t).minlen}function U(e){var t,n,o=new w.Graph({directed:!1}),r=e.nodes()[0],i=e.nodeCount();for(o.setNode(r,{});function(e,t){return e.nodes().forEach(function n(o){t.nodeEdges(o).forEach(r=>{var i=r.v,a=o===i?r.w:i;!e.hasNode(a)&&!J(t,r)&&(e.setNode(a,{}),e.setEdge(o,a,{}),n(a))})}),e.nodeCount()}(o,e)<i;)t=function(e,t){return t.edges().reduce((n,o)=>{let r=Number.POSITIVE_INFINITY;return(e.hasNode(o.v)!==e.hasNode(o.w)&&(r=J(t,o)),r<n[0])?[r,o]:n},[Number.POSITIVE_INFINITY,null])[1]}(o,e),n=o.hasNode(t.v)?J(e,t):-J(e,t),function(e,t,n){e.nodes().forEach(e=>t.node(e).rank+=n)}(o,e,n);return o}var{preorder:q,postorder:Z}=w.alg;function X(e){Y(e=A(e));var t,n,o=U(e);for(ee(o),K(o,e);t=et(o);)n=en(o,e,t),eo(o,e,t,n)}function K(e,t){var n=Z(e,e.nodes());(n=n.slice(0,n.length-1)).forEach(n=>(function(e,t,n){var o=e.node(n).parent;e.edge(n,o).cutvalue=Q(e,t,n)})(e,t,n))}X.initLowLimValues=ee,X.initCutValues=K,X.calcCutValue=Q,X.leaveEdge=et,X.enterEdge=en,X.exchangeEdges=eo;function Q(e,t,n){var o=e.node(n).parent,r=!0,i=t.edge(n,o),a=0;return!i&&(r=!1,i=t.edge(o,n)),a=i.weight,t.nodeEdges(n).forEach(i=>{var s=i.v===n,l=s?i.w:i.v;if(l!==o){var d=s===r,h=t.edge(i).weight;if(a+=d?h:-h,function(e,t,n){return e.hasEdge(t,n)}(e,n,l)){var c=e.edge(n,l).cutvalue;a+=d?-c:c}}}),a}function ee(e,t){arguments.length<2&&(t=e.nodes()[0]),function e(t,n,o,r,i){var a=o,s=t.node(r);return n[r]=!0,t.neighbors(r).forEach(i=>{!Object.hasOwn(n,i)&&(o=e(t,n,o,i,r))}),s.low=a,s.lim=o++,i?s.parent=i:delete s.parent,o}(e,{},1,t)}function et(e){return e.edges().find(t=>e.edge(t).cutvalue<0)}function en(e,t,n){var o=n.v,r=n.w;!t.hasEdge(o,r)&&(o=n.w,r=n.v);var i=e.node(o),a=e.node(r),s=i,l=!1;return i.lim>a.lim&&(s=a,l=!0),t.edges().filter(t=>l===er(e,e.node(t.v),s)&&l!==er(e,e.node(t.w),s)).reduce((e,n)=>J(t,n)<J(t,e)?n:e)}function eo(e,t,n,o){var r=n.v,i=n.w;e.removeEdge(r,i),e.setEdge(o.v,o.w,{}),ee(e),K(e,t),function(e,t){var n=e.nodes().find(e=>!t.node(e).parent),o=q(e,n);(o=o.slice(1)).forEach(n=>{var o=e.node(n).parent,r=t.edge(n,o),i=!1;!r&&(r=t.edge(o,n),i=!0),t.node(n).rank=t.node(o).rank+(i?r.minlen:-r.minlen)})}(e,t)}function er(e,t,n){return n.low<=t.lim&&t.lim<=n.lim}var ei=function(e){switch(e.graph().ranker){case"network-simplex":default:es(e);break;case"tight-tree":(function(e){Y(e),U(e)})(e);break;case"longest-path":ea(e)}},ea=Y;function es(e){X(e)}var el=function(e){let t=function(e){let t={},n=0;return e.children().forEach(function o(r){let i=n;e.children(r).forEach(o),t[r]={low:i,lim:n++}}),t}(e);e.graph().dummyChains.forEach(n=>{let o=e.node(n),r=o.edgeObj,i=function(e,t,n,o){let r,i,a=[],s=[],l=Math.min(t[n].low,t[o].low),d=Math.max(t[n].lim,t[o].lim);r=n;do r=e.parent(r),a.push(r);while(r&&(t[r].low>l||d>t[r].lim));for(i=r,r=o;(r=e.parent(r))!==i;)s.push(r);return{path:a.concat(s.reverse()),lca:i}}(e,t,r.v,r.w),a=i.path,s=i.lca,l=0,d=a[0],h=!0;for(;n!==r.w;){if(o=e.node(n),h){for(;(d=a[l])!==s&&e.node(d).maxRank<o.rank;)l++;d===s&&(h=!1)}if(!h){for(;l<a.length-1&&e.node(d=a[l+1]).minRank<=o.rank;)l++;d=a[l]}e.setParent(n,d),n=e.successors(n)[0]}})},ed={run:function(e){let t=T.addDummyNode(e,"root",{},"_root"),n=function(e){var t={};return e.children().forEach(n=>(function n(o,r){var i=e.children(o);i&&i.length&&i.forEach(e=>n(e,r+1)),t[o]=r})(n,1)),t}(e),o=Object.values(n),r=T.applyWithChunking(Math.max,o)-1,i=2*r+1;e.graph().nestingRoot=t,e.edges().forEach(t=>e.edge(t).minlen*=i);let a=function(e){return e.edges().reduce((t,n)=>t+e.edge(n).weight,0)}(e)+1;e.children().forEach(o=>(function e(t,n,o,r,i,a,s){let l=t.children(s);if(!l.length){s!==n&&t.setEdge(n,s,{weight:0,minlen:o});return}let d=T.addBorderNode(t,"_bt"),h=T.addBorderNode(t,"_bb"),c=t.node(s);t.setParent(d,s),c.borderTop=d,t.setParent(h,s),c.borderBottom=h,l.forEach(l=>{e(t,n,o,r,i,a,l);let c=t.node(l),u=c.borderTop?c.borderTop:l,g=c.borderBottom?c.borderBottom:l,p=c.borderTop?r:2*r,f=u!==g?1:i-a[s]+1;t.setEdge(d,u,{weight:p,minlen:f,nestingEdge:!0}),t.setEdge(g,h,{weight:p,minlen:f,nestingEdge:!0})}),!t.parent(s)&&t.setEdge(n,d,{weight:0,minlen:i+a[s]})})(e,t,i,a,r,n,o)),e.graph().nodeRankFactor=i},cleanup:function(e){var t=e.graph();e.removeNode(t.nestingRoot),delete t.nestingRoot,e.edges().forEach(t=>{e.edge(t).nestingEdge&&e.removeEdge(t)})}},eh=function(e){e.children().forEach(function t(n){let o=e.children(n),r=e.node(n);if(o.length&&o.forEach(t),Object.hasOwn(r,"minRank")){r.borderLeft=[],r.borderRight=[];for(let t=r.minRank,o=r.maxRank+1;t<o;++t)ec(e,"borderLeft","_bl",n,r,t),ec(e,"borderRight","_br",n,r,t)}})};function ec(e,t,n,o,r,i){let a=r[t][i-1],s=T.addDummyNode(e,"border",{width:0,height:0,rank:i,borderType:t},n);r[t][i]=s,e.setParent(s,o),a&&e.setEdge(a,s,{weight:1})}var eu={adjust:function(e){let t=e.graph().rankdir.toLowerCase();("lr"===t||"rl"===t)&&eg(e)},undo:function(e){let t=e.graph().rankdir.toLowerCase();("bt"===t||"rl"===t)&&function(e){e.nodes().forEach(t=>ef(e.node(t))),e.edges().forEach(t=>{let n=e.edge(t);n.points.forEach(ef),Object.hasOwn(n,"y")&&ef(n)})}(e),("lr"===t||"rl"===t)&&(function(e){e.nodes().forEach(t=>ey(e.node(t))),e.edges().forEach(t=>{let n=e.edge(t);n.points.forEach(ey),Object.hasOwn(n,"x")&&ey(n)})}(e),eg(e))}};function eg(e){e.nodes().forEach(t=>ep(e.node(t))),e.edges().forEach(t=>ep(e.edge(t)))}function ep(e){let t=e.width;e.width=e.height,e.height=t}function ef(e){e.y=-e.y}function ey(e){let t=e.x;e.x=e.y,e.y=t}var em=function(e,t){let n=0;for(let o=1;o<t.length;++o)n+=function(e,t,n){let o=z(n,n.map((e,t)=>t)),r=t.flatMap(t=>e.outEdges(t).map(t=>({pos:o[t.w],weight:e.edge(t).weight})).sort((e,t)=>e.pos-t.pos)),i=1;for(;i<n.length;)i<<=1;let a=2*i-1;i-=1;let s=Array(a).fill(0),l=0;return r.forEach(e=>{let t=e.pos+i;s[t]+=e.weight;let n=0;for(;t>0;)t%2&&(n+=s[t+1]),t=t-1>>1,s[t]+=e.weight;l+=e.weight*n}),l}(e,t[o-1],t[o]);return n};function ex(e,t,n){let o;for(;t.length&&(o=t[t.length-1]).i<=n;)t.pop(),e.push(o.vs),n++;return n}var ev=function e(t,n){if(n&&"function"==typeof n.customOrder){n.customOrder(t,e);return}let o=T.maxRank(t),r=eb(t,T.range(1,o+1),"inEdges"),i=eb(t,T.range(o-1,-1,-1),"outEdges"),a=function(e){let t={},n=e.nodes().filter(t=>!e.children(t).length),o=n.map(t=>e.node(t).rank),r=T.applyWithChunking(Math.max,o),i=T.range(r+1).map(()=>[]);return n.sort((t,n)=>e.node(t).rank-e.node(n).rank).forEach(function n(o){if(!t[o])t[o]=!0,i[e.node(o).rank].push(o),e.successors(o).forEach(n)}),i}(t);if(eE(t,a),n&&n.disableOptimalOrderHeuristic)return;let s=Number.POSITIVE_INFINITY,l;for(let e=0,n=0;n<4;++e,++n){(function(e,t){let n=new w.Graph;e.forEach(function(e){let o=e.graph().root,r=function e(t,n,o,r){let i=t.children(n),a=t.node(n),s=a?a.borderLeft:void 0,l=a?a.borderRight:void 0,d={};s&&(i=i.filter(e=>e!==s&&e!==l));let h=function(e,t=[]){return t.map(t=>{let n=e.inEdges(t);if(!n.length)return{v:t};{let o=n.reduce((t,n)=>{let o=e.edge(n),r=e.node(n.v);return{sum:t.sum+o.weight*r.order,weight:t.weight+o.weight}},{sum:0,weight:0});return{v:t,barycenter:o.sum/o.weight,weight:o.weight}}})}(t,i);h.forEach(n=>{if(t.children(n.v).length){let i=e(t,n.v,o,r);d[n.v]=i,Object.hasOwn(i,"barycenter")&&function(e,t){void 0!==e.barycenter?(e.barycenter=(e.barycenter*e.weight+t.barycenter*t.weight)/(e.weight+t.weight),e.weight+=t.weight):(e.barycenter=t.barycenter,e.weight=t.weight)}(n,i)}});let c=function(e,t){let n={};return e.forEach((e,t)=>{let o=n[e.v]={indegree:0,in:[],out:[],vs:[e.v],i:t};void 0!==e.barycenter&&(o.barycenter=e.barycenter,o.weight=e.weight)}),t.edges().forEach(e=>{let t=n[e.v],o=n[e.w];void 0!==t&&void 0!==o&&(o.indegree++,t.out.push(n[e.w]))}),function(e){let t=[];for(;e.length;){let n=e.pop();t.push(n),n.in.reverse().forEach(function(e){return t=>{if(!t.merged)(void 0===t.barycenter||void 0===e.barycenter||t.barycenter>=e.barycenter)&&function(e,t){let n=0,o=0;e.weight&&(n+=e.barycenter*e.weight,o+=e.weight),t.weight&&(n+=t.barycenter*t.weight,o+=t.weight),e.vs=t.vs.concat(e.vs),e.barycenter=n/o,e.weight=o,e.i=Math.min(t.i,e.i),t.merged=!0}(e,t)}}(n)),n.out.forEach(function(t){return n=>{n.in.push(t),0==--n.indegree&&e.push(n)}}(n))}return t.filter(e=>!e.merged).map(e=>T.pick(e,["vs","i","barycenter","weight"]))}(Object.values(n).filter(e=>!e.indegree))}(h,o);(function(e,t){e.forEach(e=>{e.vs=e.vs.flatMap(e=>t[e]?t[e].vs:e)})})(c,d);let u=function(e,t){let n=T.partition(e,e=>Object.hasOwn(e,"barycenter")),o=n.lhs,r=n.rhs.sort((e,t)=>t.i-e.i),i=[],a=0,s=0,l=0;o.sort(function(e){return(t,n)=>t.barycenter<n.barycenter?-1:t.barycenter>n.barycenter?1:e?n.i-t.i:t.i-n.i}(!!t)),l=ex(i,r,l),o.forEach(e=>{l+=e.vs.length,i.push(e.vs),a+=e.barycenter*e.weight,s+=e.weight,l=ex(i,r,l)});let d={vs:i.flat(!0)};return s&&(d.barycenter=a/s,d.weight=s),d}(c,r);if(s&&(u.vs=[s,u.vs,l].flat(!0),t.predecessors(s).length)){let e=t.node(t.predecessors(s)[0]),n=t.node(t.predecessors(l)[0]);!Object.hasOwn(u,"barycenter")&&(u.barycenter=0,u.weight=0),u.barycenter=(u.barycenter*u.weight+e.order+n.order)/(u.weight+2),u.weight+=2}return u}(e,o,n,t);r.vs.forEach((t,n)=>e.node(t).order=n),function(e,t,n){let o={},r;n.forEach(n=>{let i=e.parent(n),a,s;for(;i;){if((a=e.parent(i))?(s=o[a],o[a]=i):(s=r,r=i),s&&s!==i){t.setEdge(s,i);return}i=a}})}(e,n,r.vs)})})(e%2?r:i,e%4>=2),a=T.buildLayerMatrix(t);let o=em(t,a);o<s&&(n=0,l=Object.assign({},a),s=o)}eE(t,l)};function eb(e,t,n){return t.map(function(t){return function(e,t,n){let o=function(e){for(var t;e.hasNode(t=T.uniqueId("_root")););return t}(e),r=new w.Graph({compound:!0}).setGraph({root:o}).setDefaultNodeLabel(t=>e.node(t));return e.nodes().forEach(i=>{let a=e.node(i),s=e.parent(i);(a.rank===t||a.minRank<=t&&t<=a.maxRank)&&(r.setNode(i),r.setParent(i,s||o),e[n](i).forEach(t=>{let n=t.v===i?t.w:t.v,o=r.edge(n,i),a=void 0!==o?o.weight:0;r.setEdge(n,i,{weight:e.edge(t).weight+a})}),Object.hasOwn(a,"minRank")&&r.setNode(i,{borderLeft:a.borderLeft[t],borderRight:a.borderRight[t]}))}),r}(e,t,n)})}function eE(e,t){Object.values(t).forEach(t=>t.forEach((t,n)=>e.node(t).order=n))}function ew(e,t,n){if(t>n){let e=t;t=n,n=e}let o=e[t];!o&&(e[t]=o={}),o[n]=!0}var eN=function(e){var t,n,o,r,i,a,s,l;let d,h,c,u,g,p,f,y,m;(function(e){let t=T.buildLayerMatrix(e),n=e.graph().ranksep,o=0;t.forEach(t=>{let r=t.reduce((t,n)=>{let o=e.node(n).height;return t>o?t:o},0);t.forEach(t=>e.node(t).y=o+r/2),o+=r+n})})(e=T.asNonCompoundGraph(e));Object.entries((t=e,h=T.buildLayerMatrix(t),u=Object.assign((n=t,c={},(o=h).length&&o.reduce(function(e,t){let o=0,r=0,i=e.length,a=t[t.length-1];return t.forEach((e,s)=>{let l=function(e,t){if(e.node(t).dummy)return e.predecessors(t).find(t=>e.node(t).dummy)}(n,e),d=l?n.node(l).order:i;(l||e===a)&&(t.slice(r,s+1).forEach(e=>{n.predecessors(e).forEach(t=>{let r=n.node(t),i=r.order;(i<o||d<i)&&!(r.dummy&&n.node(e).dummy)&&ew(c,t,e)})}),r=s+1,o=d)}),t}),c),function(e,t){let n={};function o(t,o,r,i,a){let s;T.range(o,r).forEach(o=>{s=t[o],e.node(s).dummy&&e.predecessors(s).forEach(t=>{let o=e.node(t);o.dummy&&(o.order<i||o.order>a)&&ew(n,t,s)})})}return t.length&&t.reduce(function(t,n){let r=-1,i,a=0;return n.forEach((s,l)=>{if("border"===e.node(s).dummy){let t=e.predecessors(s);t.length&&(i=e.node(t[0]).order,o(n,a,l,r,i),a=l,r=i)}o(n,a,n.length,i,t.length)}),n}),n}(t,h)),g={},["u","d"].forEach(e=>{d="u"===e?h:Object.values(h).reverse(),["l","r"].forEach(n=>{var o,r,i,a;let s,l,h;"r"===n&&(d=d.map(e=>Object.values(e).reverse()));let c=("u"===e?t.predecessors:t.successors).bind(t);let p=(o=0,r=d,i=u,a=c,s={},l={},h={},r.forEach(e=>{e.forEach((e,t)=>{s[e]=e,l[e]=e,h[e]=t})}),r.forEach(e=>{let t=-1;e.forEach(e=>{let n=a(e);if(n.length){let o=((n=n.sort((e,t)=>h[e]-h[t])).length-1)/2;for(let r=Math.floor(o),a=Math.ceil(o);r<=a;++r){let o=n[r];l[e]===e&&t<h[o]&&!function(e,t,n){if(t>n){let e=t;t=n,n=e}return!!e[t]&&Object.hasOwn(e[t],n)}(i,e,o)&&(l[o]=e,l[e]=s[e]=s[o],t=h[o])}}})}),{root:s,align:l}),f=function(e,t,n,o,r){let i={},a=function(e,t,n,o){let r=new w.Graph,i=e.graph(),a=function(e,t,n){return(o,r,i)=>{let a,s,l=o.node(r),d=o.node(i);if(a=0+l.width/2,Object.hasOwn(l,"labelpos"))switch(l.labelpos.toLowerCase()){case"l":s=-l.width/2;break;case"r":s=l.width/2}if(s&&(a+=n?s:-s),s=0,a+=(l.dummy?t:e)/2,a+=(d.dummy?t:e)/2,a+=d.width/2,Object.hasOwn(d,"labelpos"))switch(d.labelpos.toLowerCase()){case"l":s=d.width/2;break;case"r":s=-d.width/2}return s&&(a+=n?s:-s),s=0,a}}(i.nodesep,i.edgesep,o);return t.forEach(t=>{let o;t.forEach(t=>{let i=n[t];if(r.setNode(i),o){var s=n[o],l=r.edge(s,i);r.setEdge(s,i,Math.max(a(e,t,o),l||0))}o=t})}),r}(e,t,n,r),s=r?"borderLeft":"borderRight";function l(e,t){let n=a.nodes(),o=n.pop(),r={};for(;o;)r[o]?e(o):(r[o]=!0,n.push(o),n=n.concat(t(o))),o=n.pop()}return l(function(e){i[e]=a.inEdges(e).reduce((e,t)=>Math.max(e,i[t.v]+a.edge(t)),0)},a.predecessors.bind(a)),l(function(t){let n=a.outEdges(t).reduce((e,t)=>Math.min(e,i[t.w]-a.edge(t)),Number.POSITIVE_INFINITY),o=e.node(t);n!==Number.POSITIVE_INFINITY&&o.borderType!==s&&(i[t]=Math.max(i[t],n))},a.successors.bind(a)),Object.keys(o).forEach(e=>i[e]=i[n[e]]),i}(t,d,p.root,p.align,"r"===n);"r"===n&&(f=T.mapValues(f,e=>-e)),g[e+n]=f})}),p=(r=t,Object.values(g).reduce((e,t)=>{let n=Number.NEGATIVE_INFINITY,o=Number.POSITIVE_INFINITY;Object.entries(t).forEach(([e,t])=>{let i=function(e,t){return e.node(t).width}(r,e)/2;n=Math.max(t+i,n),o=Math.min(t-i,o)});let i=n-o;return i<e[0]&&(e=[i,t]),e},[Number.POSITIVE_INFINITY,null])[1]),i=g,f=Object.values(a=p),y=T.applyWithChunking(Math.min,f),m=T.applyWithChunking(Math.max,f),["u","d"].forEach(e=>{["l","r"].forEach(t=>{let n=e+t,o=i[n];if(o===a)return;let r=Object.values(o),s=y-T.applyWithChunking(Math.min,r);"l"!==t&&(s=m-T.applyWithChunking(Math.max,r)),s&&(i[n]=T.mapValues(o,e=>e+s))})}),s=g,l=t.graph().align,T.mapValues(s.ul,(e,t)=>{if(l)return s[l.toLowerCase()][t];{let e=Object.values(s).map(e=>e[t]).sort((e,t)=>e-t);return(e[1]+e[2])/2}}))).forEach(([t,n])=>e.node(t).x=n)};function eL(e,t){e.nodes().forEach(n=>{let o=e.node(n),r=t.node(n);o&&(o.x=r.x,o.y=r.y,o.rank=r.rank,t.children(n).length&&(o.width=r.width,o.height=r.height))}),e.edges().forEach(n=>{let o=e.edge(n),r=t.edge(n);o.points=r.points,Object.hasOwn(r,"x")&&(o.x=r.x,o.y=r.y)}),e.graph().width=t.graph().width,e.graph().height=t.graph().height}var eS=["nodesep","edgesep","ranksep","marginx","marginy"],eM={ranksep:50,edgesep:20,nodesep:50,rankdir:"tb"},ek=["acyclicer","ranker","rankdir","align"],eD=["width","height"],eI={width:0,height:0},eC=["minlen","weight","width","height","labeloffset"],eO={minlen:1,weight:1,width:0,height:0,labeloffset:10,labelpos:"r"},eT=["labelpos"];function e_(e){let t=new w.Graph({multigraph:!0,compound:!0}),n=eJ(e.graph());return t.setGraph(Object.assign({},eM,eY(n,eS),T.pick(n,ek))),e.nodes().forEach(n=>{let o=eY(eJ(e.node(n)),eD);Object.keys(eI).forEach(e=>{void 0===o[e]&&(o[e]=eI[e])}),t.setNode(n,o),t.setParent(n,e.parent(n))}),e.edges().forEach(n=>{let o=eJ(e.edge(n));t.setEdge(n,Object.assign({},eO,eY(o,eC),T.pick(o,eT)))}),t}function eA(e){let t=e.graph();t.ranksep/=2,e.edges().forEach(n=>{let o=e.edge(n);o.minlen*=2,"c"!==o.labelpos.toLowerCase()&&("TB"===t.rankdir||"BT"===t.rankdir?o.width+=o.labeloffset:o.height+=o.labeloffset)})}function eP(e){e.edges().forEach(t=>{let n=e.edge(t);if(n.width&&n.height){let n=e.node(t.v),o={rank:(e.node(t.w).rank-n.rank)/2+n.rank,e:t};T.addDummyNode(e,"edge-proxy",o,"_ep")}})}function eR(e){let t=0;e.nodes().forEach(n=>{let o=e.node(n);o.borderTop&&(o.minRank=e.node(o.borderTop).rank,o.maxRank=e.node(o.borderBottom).rank,t=Math.max(t,o.maxRank))}),e.graph().maxRank=t}function e$(e){e.nodes().forEach(t=>{let n=e.node(t);"edge-proxy"===n.dummy&&(e.edge(n.e).labelRank=n.rank,e.removeNode(t))})}function eV(e){let t=Number.POSITIVE_INFINITY,n=0,o=Number.POSITIVE_INFINITY,r=0,i=e.graph(),a=i.marginx||0,s=i.marginy||0;function l(e){let i=e.x,a=e.y,s=e.width,l=e.height;t=Math.min(t,i-s/2),n=Math.max(n,i+s/2),o=Math.min(o,a-l/2),r=Math.max(r,a+l/2)}e.nodes().forEach(t=>l(e.node(t))),e.edges().forEach(t=>{let n=e.edge(t);Object.hasOwn(n,"x")&&l(n)}),t-=a,o-=s,e.nodes().forEach(n=>{let r=e.node(n);r.x-=t,r.y-=o}),e.edges().forEach(n=>{let r=e.edge(n);r.points.forEach(e=>{e.x-=t,e.y-=o}),Object.hasOwn(r,"x")&&(r.x-=t),Object.hasOwn(r,"y")&&(r.y-=o)}),i.width=n-t+a,i.height=r-o+s}function eB(e){e.edges().forEach(t=>{let n,o,r=e.edge(t),i=e.node(t.v),a=e.node(t.w);r.points?(n=r.points[0],o=r.points[r.points.length-1]):(r.points=[],n=a,o=i),r.points.unshift(T.intersectRect(i,n)),r.points.push(T.intersectRect(a,o))})}function ej(e){e.edges().forEach(t=>{let n=e.edge(t);if(Object.hasOwn(n,"x"))switch(("l"===n.labelpos||"r"===n.labelpos)&&(n.width-=n.labeloffset),n.labelpos){case"l":n.x-=n.width/2+n.labeloffset;break;case"r":n.x+=n.width/2+n.labeloffset}})}function eF(e){e.edges().forEach(t=>{let n=e.edge(t);n.reversed&&n.points.reverse()})}function eH(e){e.nodes().forEach(t=>{if(e.children(t).length){let n=e.node(t),o=e.node(n.borderTop),r=e.node(n.borderBottom),i=e.node(n.borderLeft[n.borderLeft.length-1]),a=e.node(n.borderRight[n.borderRight.length-1]);n.width=Math.abs(a.x-i.x),n.height=Math.abs(r.y-o.y),n.x=i.x+n.width/2,n.y=o.y+n.height/2}}),e.nodes().forEach(t=>{"border"===e.node(t).dummy&&e.removeNode(t)})}function ez(e){e.edges().forEach(t=>{if(t.v===t.w){var n=e.node(t.v);!n.selfEdges&&(n.selfEdges=[]),n.selfEdges.push({e:t,label:e.edge(t)}),e.removeEdge(t)}})}function eG(e){T.buildLayerMatrix(e).forEach(t=>{var n=0;t.forEach((t,o)=>{var r=e.node(t);r.order=o+n,(r.selfEdges||[]).forEach(t=>{T.addDummyNode(e,"selfedge",{width:t.label.width,height:t.label.height,rank:r.rank,order:o+ ++n,e:t.e,label:t.label},"_se")}),delete r.selfEdges})})}function eW(e){e.nodes().forEach(t=>{var n=e.node(t);if("selfedge"===n.dummy){var o=e.node(n.e.v),r=o.x+o.width/2,i=o.y,a=n.x-r,s=o.height/2;e.setEdge(n.e,n.label),e.removeNode(t),n.label.points=[{x:r+2*a/3,y:i-s},{x:r+5*a/6,y:i-s},{x:r+a,y:i},{x:r+5*a/6,y:i+s},{x:r+2*a/3,y:i+s}],n.label.x=n.x,n.label.y=n.y}})}function eY(e,t){return T.mapValues(T.pick(e,t),Number)}function eJ(e){var t={};return e&&Object.entries(e).forEach(([e,n])=>{"string"==typeof e&&(e=e.toLowerCase()),t[e]=n}),t}var eU=e_,eq=eL,eZ=eA,eX=ez,eK=G,eQ=ed,e0=ei,e1=T,e2=eP,e3=R,e6=P,e4=eR,e5=e$,e8=W,e7=el,e9=eh,te=ev,tt=eG,tn=eu,to=eN,tr=eW,ti=eH,ta=ej,ts=eV,tl=eB,td=eF,th=class{constructor(){this.init=!1}get initialized(){return this.init}getNode(e){return this.store.nodes.get(e)}getNodeByIndex(e){let t=this.indexMap.get(e);return t?this.getNode(t):void 0}getEdge(e){return this.store.edges.get(e)}get nodes(){return Array.from(this.store.nodes.values())}get edges(){return Array.from(this.store.edges.values())}create(e){this.store=this.createStore(e),this.indexMap=this.createIndexMap(),this.init=!0}createStore(e){let{nodes:t,edges:n}=e,o={nodes:new Map,edges:new Map};return t.forEach((e,t)=>{let{bounds:n}=e.getData(f.eG),r={id:e.id,entity:e,index:"",rank:-1,order:-1,position:{x:n.center.x,y:n.center.y},offset:{x:0,y:0},size:{width:n.width,height:n.height},hasChildren:e.collapsedChildren?.length>0};o.nodes.set(r.id,r)}),n.forEach(e=>{let{from:t,to:n}=e.info;if(!t||!n||e.vertical)return;let r={id:e.id,entity:e,from:t,to:n,fromIndex:"",toIndex:"",name:e.id};o.edges.set(r.id,r)}),o}createIndexMap(){let e=this.sortNodes(),t=new Map;e.forEach((e,n)=>{let o=this.getNode(e);if(!o)return;let r=String(1e5+n);t.set(o.id,r),o.index=r}),this.edges.forEach(e=>{let n=t.get(e.from),o=t.get(e.to);if(!n||!o){this.store.edges.delete(e.id);return}e.fromIndex=n,e.toIndex=o});let n=new Map;return t.forEach((e,t)=>{n.set(e,t)}),n}sortNodes(){let e=[];this.nodes.forEach(t=>{e.push(t.id)});let t=new Map;return this.edges.forEach(n=>{if(e.push(n.to),n.entity.info.fromPort){let e=t.get(n.from)||[];t.set(n.from,[...e,n])}}),t.forEach((t,n)=>{t.sort((e,t)=>{let n=e.entity.fromPort,o=t.entity.fromPort;return n&&o?n.point.y-o.point.y:0}).forEach(t=>{e.push(t.to)})}),e.reduceRight((e,t)=>(!e.includes(t)&&e.unshift(t),e),[])}},tc=class{constructor(e){this.store=e}async position(){return new Promise(e=>{(0,u.p4)({from:{d:0},to:{d:100},duration:300,onUpdate:e=>{this.store.nodes.forEach(t=>{this.updateNodePosition({layoutNode:t,step:e.d})})},onComplete:()=>{e()}})})}updateNodePosition(e){let{layoutNode:t,step:n}=e,o=t.entity.getData(u.VO),r={x:t.position.x+t.offset.x,y:t.position.y+t.offset.y},i=(r.x-o.position.x)*n/100,a=(r.y-o.bounds.height/2-o.position.y)*n/100;t.hasChildren&&t.entity.collapsedChildren.forEach(e=>{e.getData(f.eG).fireChange()}),o.update({position:{x:o.position.x+i,y:o.position.y+a}})}},tu={rankdir:"LR",nodesep:100,ranksep:100,ranker:"network-simplex"},tg=class{constructor(e){this.store=e,this.graph=this.createGraph()}layout(){this.graphSetData(),this.dagreLayout(),this.layoutSetPosition()}dagreLayout(){let e=eU(this.graph);this.runLayout(e),eq(this.graph,e)}runLayout(e){eZ(e),eX(e),eK.run(e),eQ.run(e),e0(e1.asNonCompoundGraph(e)),e2(e),e3(e),eQ.cleanup(e),e6(e),e4(e),e5(e),e8.run(e),e7(e),e9(e),te(e),this.setOrderAndRank(e),tt(e),tn.adjust(e),to(e),tr(e),ti(e),e8.undo(e),ta(e),tn.undo(e),ts(e),tl(e),td(e),eK.undo(e)}createGraph(){let e=new w.Graph({multigraph:!0});return e.setDefaultEdgeLabel(()=>({})),e.setGraph(tu),e}graphSetData(){let e=Array.from(this.store.nodes.values()),t=Array.from(this.store.edges.values()).sort((e,t)=>e.fromIndex===t.fromIndex?e.toIndex<t.toIndex?-1:1:e.fromIndex<t.fromIndex?-1:1);e.forEach(e=>{this.graph.setNode(e.index,{originID:e.id,width:e.size.width,height:e.size.height})}),t.forEach(e=>{this.graph.setEdge({v:e.fromIndex,w:e.toIndex,name:e.name})})}layoutSetPosition(){this.store.nodes.forEach(e=>{let t=this.getOffsetX(e),n=this.graph.node(e.index);if(!n){e.rank=-1,e.position={x:e.position.x+t,y:e.position.y};return}e.rank=n.rank??-1,e.position={x:this.normalizeNumber(n.x)+t,y:this.normalizeNumber(n.y)}})}normalizeNumber(e){return Number.isNaN(e)?0:e}getOffsetX(e){if(!e.hasChildren)return 0;let{bounds:t,padding:n}=e.entity.getData(f.eG);return-t.width/2+n.left}setOrderAndRank(e){return this.followAdjust(e),this.normalizeOrder(e),e}followAdjust(e){let t=this.rankGroup(e);e.nodes().forEach(n=>{let o=e.node(n),r=this.store.getNodeByIndex(n);if(!o||!r?.followedBy)return;let{followedBy:i}=r,{rank:a,order:s}=o,l=i.map(e=>this.store.getNode(e)?.index).filter(Boolean),d=new Set(l),h=t.get(a);if(!!h)Array.from(h).filter(t=>!d.has(t)&&e.node(t).order>s).forEach(t=>{let n=e.node(t);n.order=n.order+i.length}),l.forEach((n,o)=>{let r=e.node(n);r.order=s+o+1;let i=r.rank;r.rank=a,t.get(i)?.delete(n),t.get(a)?.add(n)})})}normalizeOrder(e){this.rankGroup(e).forEach((t,n)=>{let o=Array.from(t).map(t=>e.node(t));o.sort((e,t)=>e.order-t.order),o.forEach((e,t)=>{e.order=t})})}rankGroup(e){let t=new Map;return e.nodes().forEach(n=>{let o=e.node(n).rank;!t.has(o)&&t.set(o,new Set),t.get(o)?.add(n)}),t}},tp=class{constructor(){this._store=new th,this._layout=new tg(this._store),this._position=new tc(this._store)}init(e,t={}){this._store.create(e),this.setFollowNode(t.getFollowNode)}layout(){if(!!this._store.initialized)this._layout.layout()}async position(){if(!!this._store.initialized)return await this._position.position()}setFollowNode(e){if(!e)return;let t={store:this._store};this._store.nodes.forEach(n=>{let o=e(n,t)?.followTo;if(!o)return;let r=this._store.getNode(o);r&&(!r.followedBy&&(r.followedBy=[]),r.followedBy.push(n.id),n.followTo=o)})}},tf=class{async layout(e={}){await this.layoutNode(this.document.root,e)}async layoutNode(e,t){let n=e.collapsedChildren;if(!n||!Array.isArray(n)||!n.length)return;let o=e.collapsedChildren.map(e=>e.getData(a.Z1).outputLines.filter(Boolean)).flat();await Promise.all(n.map(async e=>this.layoutNode(e,t)));let r=new tp;r.init({nodes:n,edges:o},t),r.layout(),await r.position()}};S([(0,g.f3)(a.L4)],tf.prototype,"document",2),tf=S([(0,g.b2)()],tf);var ty=(0,u.M1)({onBind:({bind:e})=>{e(tf).toSelf().inSingletonScope()}}),tm=n("65881"),tx=Object.defineProperty,tv=Object.getOwnPropertyDescriptor,tb=Object.getOwnPropertyNames,tE=Object.prototype.hasOwnProperty,tw=(e,t)=>{for(var n in t)tx(e,n,{get:t[n],enumerable:!0})},tN=(e,t,n,o)=>{if(t&&"object"==typeof t||"function"==typeof t)for(let r of tb(t))!tE.call(e,r)&&r!==n&&tx(e,r,{get:()=>t[r],enumerable:!(o=tv(t,r))||o.enumerable});return e},tL=(e,t,n)=>(tN(e,t,"default"),n&&tN(n,t,"default")),tS={};tw(tS,{FreeLayoutEditor:()=>tO,FreeLayoutEditorProvider:()=>tI,FreeLayoutProps:()=>r,WorkflowNodeRenderer:()=>tC,WorkflowPortRender:()=>c.Jb,createFreeLayoutPreset:()=>tD,useAutoLayout:()=>t$,useClientContext:()=>tV,usePlaygroundTools:()=>tB});var tM={};tw(tM,{FreeLayoutEditor:()=>tO,FreeLayoutEditorProvider:()=>tI,WorkflowNodeRenderer:()=>tC,WorkflowPortRender:()=>c.Jb}),(r||(r={})).DEFAULT={...i.nYJ.DEFAULT,fromNodeJSON(e,t){if(!e.getData(i.Psq)){t.data&&e.updateExtInfo(t.data),e.onExtInfoChange(()=>{e.document.fireContentChange({type:a.fT.NODE_DATA_CHANGE,toJSON:()=>e.getExtInfo(),entity:e})});return}return a.jg.fromNodeJSON?.(e,t)},toNodeJSON(e){let t=e.getData(i.Psq),n=e.transform.position;return t?a.jg.toNodeJSON(e):{id:e.id,type:e.flowNodeType,meta:{position:{x:n.x,y:n.y}},data:e.getExtInfo()}}};var tk=e=>{let t=e.get(h.StackingContextManager);if(t.node)return t.node};function tD(e){return t=>{e={...r.DEFAULT,...e,playground:{...e.playground,get hoverService(){return t.get(a.XH)}}};let n=[];return n.push((0,i.cL)({registerShortcuts(n){let o=t.get(i.z2R);if(n.addHandlers({commandId:a.uB.DELETE_NODES,shortcuts:["backspace","delete"],isEnabled:()=>o.selection.length>0&&!t.playground.config.readonlyOrDisabled,execute:()=>{o.selection.forEach(e=>{if(e instanceof a.CT){if(!t.document.canRemove(e))return;let n=e.getNodeMeta(),o=n.subCanvas?.(e);if(o?.isCanvas){o.parentNode.dispose();return}e.dispose()}else if(e instanceof a.e2){if(!t.document.linesManager.canRemove(e))return;e.dispose()}}),o.selection=o.selection.filter(e=>!e.disposed)}}),e?.history?.enable){let o=t.get(l.qp);!e.history.disableShortcuts&&(n.addHandlers({commandId:i.mYg.Default.UNDO,shortcuts:["meta z","ctrl z"],isEnabled:()=>!0,execute:()=>{o.undo()}}),n.addHandlers({commandId:i.mYg.Default.REDO,shortcuts:["meta shift z","ctrl shift z"],isEnabled:()=>!0,execute:()=>{o.redo()}}))}}})),n=(0,i.Fu1)(e,n)(t),e.variableEngine?.enable&&n.push((0,i.Ys9)({...e.variableEngine,layout:"free"})),e.history?.enable&&n.push((0,l.ou)(e.history)),n.push((0,i.d3V)({onBind:n=>{n.rebind(a.fY).toConstantValue({canAddLine:e.canAddLine?.bind(null,t),canDeleteLine:e.canDeleteLine?.bind(null,t),isErrorLine:e.isErrorLine?.bind(null,t),isErrorPort:e.isErrorPort?.bind(null,t),isDisabledPort:e.isDisabledPort?.bind(null,t),isReverseLine:e.isReverseLine?.bind(null,t),isHideArrowLine:e.isHideArrowLine?.bind(null,t),isFlowingLine:e.isFlowingLine?.bind(null,t),isDisabledLine:e.isDisabledLine?.bind(null,t),isVerticalLine:e.isVerticalLine?.bind(null,t),onDragLineEnd:e.onDragLineEnd?.bind(null,t),setLineRenderType:e.setLineRenderType?.bind(null,t),setLineClassName:e.setLineClassName?.bind(null,t),canDeleteNode:e.canDeleteNode?.bind(null,t),canResetLine:e.canResetLine?.bind(null,t),cursors:e.cursors??a.jg.cursors,lineColor:e.lineColor??a.jg.lineColor,allNodesDefaultExpanded:e.allNodesDefaultExpanded,toNodeJSON:e.toNodeJSON,fromNodeJSON:e.fromNodeJSON})},onInit:t=>{t.playground.registerLayer(i.Emw),t.playground.registerLayer(i.V7e,{renderElement:()=>"function"==typeof tk?tk(t):tk}),!e.scroll?.disableScrollLimit&&t.playground.registerLayer(i.qq0),!e.scroll?.disableScrollBar&&t.playground.registerLayer(i.lVg),e.onContentChange&&t.document.onContentChange(n=>e.onContentChange(t,n))},containerModules:[a._s]}),(0,h.createFreeStackPlugin)({}),(0,c.J2)({}),E({}),ty({}),(0,d.Y)({canSelect:e=>{if(0!==e.button)return!1;let n=e.target;if(n){if(n.closest('[data-flow-editor-selectable="true"]'))return!0;if(n.closest('[data-flow-editor-selectable="false"]'))return!1}return!t.get(a.XH).isSomeHovered()&&!0},ignoreOneSelect:!0,...e.selectBox||{}})),n}}var tI=(0,s.forwardRef)(function(e,t){let{children:n,...o}=e,r=(0,s.useMemo)(()=>tD(o),[]),d=(0,s.useCallback)(e=>({...(0,i.FwO)(e),get document(){return e.get(a.L4)},get clipboard(){return e.get(i.YvH)},get selection(){return e.get(i.z2R)},get history(){return e.get(l.qp)}}),[]);return s.createElement(i.W6u,{ref:t,plugins:r,customPluginContext:d},n)}),tC=e=>{let{selected:t,activated:n,startDrag:o,ports:r,selectNode:i,nodeRef:l,onFocus:d,onBlur:h}=(0,a.PV)(),u=(0,tm.Z)(e.className||"",{activated:n,selected:t});return s.createElement(s.Fragment,null,s.createElement("div",{className:u,style:e.style,ref:l,draggable:!0,onDragStart:o,onClick:i,onFocus:d,onBlur:h,"data-node-selected":String(t)},e.children),r.map(t=>s.createElement(c.Jb,{key:t.id,entity:t,onClick:e.onPortClick?n=>e.onPortClick(t,n):void 0,className:e.portClassName,style:e.portStyle})))},tO=(0,s.forwardRef)(function(e,t){let{children:n,...o}=e;return s.createElement(tI,{ref:t,...o},s.createElement(i.R6T,null,n))});tL(tM,h),tL(tS,tM);var tT=e=>{let t=e.getData(i.VOn);return{x:t.position.x,y:t.position.y}},t_=()=>{let e=(0,a.KU)();try{return e.get(l.qp)}catch(e){return{pushOperation:()=>{}}}},tA=()=>{let e=t_();return(0,s.useCallback)(t=>{let{nodes:n,startPositions:o,endPositions:r}=t,i=n.map(e=>e.id);e.pushOperation({type:l.Nj.dragNodes,value:{ids:i,value:r,oldValue:o}},{noApply:!0})},[e])},tP=e=>{let{nodes:t,startPositions:n}=e;return()=>{t.forEach((e,t)=>{let o=e.getData(i.VOn),r=n[t];o.update({position:r})})}},tR=()=>{let e=(0,a.G2)(a.L4),t=(0,a.G2)(tf),n=tA();return(0,s.useCallback)(async o=>{let r=e.getAllNodes(),i=r.map(tT);await t.layout(o);let a=r.map(tT);return n({nodes:r,startPositions:i,endPositions:a}),tP({nodes:r,startPositions:i})},[t,e,n])},t$=()=>{let e=(0,a.G2)(a.L4),t=(0,a.Dc)(),n=tR(),o=(0,s.useCallback)(n=>{(0,a.Qu)(e,t.config,n)},[e,t]);return(0,s.useCallback)(async e=>{o();let t=await n(e);return o(),t},[n])};function tV(){return(0,i.G2Z)(i.Zn3)}function tB(){let e=(0,a.Dc)(),t=(0,a.G2)(a.L4),[n,o]=(0,s.useState)(1),[r,l]=(0,s.useState)(t.linesManager.lineType),[d,h]=(0,s.useState)(a.YC.SELECT),[c,u]=(0,s.useState)(a.v6.PAD),g=(0,s.useCallback)(t=>{if(!(n<.1))e?.config.zoomout(t)},[n,e]),p=(0,s.useCallback)(t=>{if(!(n>1.9))e?.config.zoomin(t)},[n,e]),f=(0,s.useCallback)(e=>{let n=t.linesManager.switchLineType(e);return l(n),n},[t]),y=(0,s.useCallback)(n=>{(0,a.Qu)(t,e.config,n)},[t,e]),m=t$();return(0,s.useEffect)(()=>{let t=null;return e&&(t=e.onZoom(e=>o(e))),()=>{t&&t.dispose()}},[e]),(0,s.useEffect)(()=>{let t=e.editorState.onStateChange(e=>{h(e.state===i.yyW.STATE_GRAB||e.state===i.yyW.STATE_MOUSE_FRIENDLY_SELECT?a.YC.GRAB:a.YC.SELECT),u(e.state===i.yyW.STATE_MOUSE_FRIENDLY_SELECT?a.v6.MOUSE:a.v6.PAD)});return()=>{t.dispose()}},[e]),{zoomin:p,zoomout:g,fitView:y,autoLayout:m,switchLineType:f,zoom:n,lineType:r,cursorState:d,setCursorState:function(t){let n;if(void 0!==(n="function"==typeof t?t({isPressingSpaceBar:e.editorState.isPressingSpaceBar,cursorState:d}):t))n===a.YC.GRAB?(e.editorState.changeState(i.yyW.STATE_GRAB.id),h(n)):(n=a.YC.SELECT)&&(e.editorState.changeState(i.yyW.STATE_SELECT.id),h(n))},interactiveType:c,setInteractiveType:function(t){t===a.v6.MOUSE?(e.editorState.changeState(i.yyW.STATE_MOUSE_FRIENDLY_SELECT.id),h(a.YC.GRAB)):t===a.v6.PAD&&(e.editorState.changeState(i.yyW.STATE_SELECT.id),h(a.YC.SELECT)),u(t)},setMouseScrollDelta:function(t){e.config.updateConfig({mouseScrollDelta:t})}}}},767839:function(e,t,n){n.d(t,{Nj:function(){return y},ou:function(){return P},qp:function(){return i.qp}});var o,r=n(213153),i=n(246038),a=n(362270),s=n(461932),l=n(177783),d=n(664881),h=n(682264),c=n(215206);n(908600);var u=Object.defineProperty,g=Object.getOwnPropertyDescriptor,p=(e,t,n,o)=>{for(var r=o>1?void 0:o?g(t,n):t,i,a=e.length-1;a>=0;a--)(i=e[a])&&(r=(o?i(t,n,r):i(r))||r);return o&&r&&u(t,n,r),r},f=class{constructor(){this._entityDataValues=new Map,this._toDispose=new l.K4}addEntityData(e){this._entityDataValues.set(e,(0,a.cloneDeep)(e.toJSON())),this._toDispose.push(e.onWillChange(t=>{let n=t.toJSON(),o=this._entityDataValues.get(e);if(!(0,a.isEqual)(n,o))this._entityDataValues.set(e,(0,a.cloneDeep)(n))}))}getValue(e){return this._entityDataValues.get(e)}setValue(e,t){return this._entityDataValues.set(e,t)}dispose(){this._entityDataValues.clear(),this._toDispose.dispose()}};f=p([(0,s.b2)()],f);var y=((o=y||{}).addLine="addLine",o.deleteLine="deleteLine",o.moveNode="moveNode",o.addNode="addNode",o.deleteNode="deleteNode",o.changeNodeData="changeNodeData",o.resetLayout="resetLayout",o.dragNodes="dragNodes",o),m=class{handle(e){"onDragEnd"===e.type&&!e.altKey&&this._dragNode(e)}_dragNode(e){this._historyService.pushOperation({type:"dragNodes",value:{ids:e.nodes.map(e=>e.id),value:e.nodes.map(e=>{let{x:t,y:n}=e.getData(r.VO).position;return{x:t,y:n}}),oldValue:e.startPositions}},{noApply:!0})}};p([(0,s.f3)(i.qp)],m.prototype,"_historyService",2),m=p([(0,s.b2)()],m);var x=class{constructor(){this.enable=!1,this.nodeToJSON=e=>e.toJSON(),this.getNodeLabelById=e=>e,this.getNodeLabel=e=>e.id,this.getBlockLabel=e=>e.id,this.getNodeURI=e=>`node:${e}`,this.getLineURI=e=>`line:${e}`}init(e,t){this.enable=!!t?.enable,t.nodeToJSON&&(this.nodeToJSON=t.nodeToJSON(e)),t.getNodeLabelById&&(this.getNodeLabelById=t.getNodeLabelById(e)),t.getNodeLabel&&(this.getNodeLabel=t.getNodeLabel(e)),t.getBlockLabel&&(this.getBlockLabel=t.getBlockLabel(e)),t.getNodeURI&&(this.getNodeURI=t.getNodeURI(e)),t.getLineURI&&(this.getLineURI=t.getLineURI(e))}};x=p([(0,s.b2)()],x);var v=class{handle(e){let{path:t,value:n,initialized:o,node:r}=e,i=r.getData(d.Ps),s=this._entityManager.getValue(i),l=t.split("/").filter(Boolean).join("."),h=l?(0,a.get)(s,l):s;if(!(0,a.isEqual)(n,h)){if(o){let e=t,o=(0,a.cloneDeep)(n),i=h;if("/"!==t){let r=(0,a.cloneDeep)(s);(0,a.set)(r,l,n),e=t.split("/").filter(Boolean)[0],o=(0,a.get)(r,e),i=(0,a.get)(s,e)}this._historyService.pushOperation({type:"changeNodeData",value:{id:r.id,path:e,value:o,oldValue:i},uri:this._config.getNodeURI(r.id)},{noApply:!0})}l?(0,a.set)(s,l,(0,a.cloneDeep)(n)):this._entityManager.setValue(i,(0,a.cloneDeep)(n))}}};p([(0,s.f3)(i.qp)],v.prototype,"_historyService",2),p([(0,s.f3)(h.L4)],v.prototype,"document",2),p([(0,s.f3)(f)],v.prototype,"_entityManager",2),p([(0,s.f3)(x)],v.prototype,"_config",2),v=p([(0,s.b2)()],v);var b={type:h.fT.DELETE_NODE,toOperation:async(e,t)=>{let n=t.get(x),o=t.get(h.L4),r=e.entity,i=await o.toNodeJSON(r),a=r.parent?.id;return await (0,h.gw)(0),{type:"deleteNode",value:{node:i,parentID:a},uri:n.getNodeURI(r.id)}}},E={type:h.fT.DELETE_LINE,toOperation:(e,t)=>{let n=t.get(x),o=e.entity;return{type:"deleteLine",value:{from:o.info.from,to:o.info.to||"",fromPort:o.info.fromPort||"",toPort:o.info.toPort||"",id:o.id},uri:n.getNodeURI(o.id)}}},w={type:h.fT.ADD_NODE,toOperation:async(e,t)=>{let n=t.get(x),o=t.get(h.L4),r=e.entity,i=r.parent?.id;return await (0,h.gw)(10),{type:"addNode",value:{node:await o.toNodeJSON(r),parentID:i},uri:n.getNodeURI(r.id)}}},N=[{type:h.fT.ADD_LINE,toOperation:(e,t)=>{let n=t.get(x),o=e.entity;return{type:"addLine",value:{from:o.info.from,to:o.info.to||"",fromPort:o.info.fromPort||"",toPort:o.info.toPort||"",id:o.id},uri:n.getLineURI(o.id)}}},E,w,b],L=class{async handle(e,t){if(!this._historyService.undoRedoService.canPush())return;let n=N.find(t=>t.type===e.type);if(!n)return;let o=await n.toOperation(e,t);if(!!o)this._historyService.pushOperation(o,{noApply:!0})}};p([(0,s.f3)(i.qp)],L.prototype,"_historyService",2),L=p([(0,s.b2)()],L);var S={shouldMerge:(e,t,n)=>!!t&&(!!(Date.now()-n.getTimestamp()<500)||!1)},M={...S,type:"resetLayout",inverse:e=>({...e,value:{...e.value,value:e.value.oldValue,oldValue:e.value.value}}),apply:async(e,t)=>{let n=t.get(h.ZO);await n.layoutToPositions(e.value.ids,e.value.value)},shouldMerge:()=>!1},k={...S,type:"dragNodes",inverse:e=>({...e,value:{...e.value,value:e.value.oldValue,oldValue:e.value.value}}),apply:(e,t)=>{e.value.ids.forEach((n,o)=>{let i=t.get(h.L4).getNode(n);if(!i)return;let a=i.getData(r.VO),s=e.value.value[o];a.update({position:{x:s.x,y:s.y}}),i.collapsedChildren?.length>0&&i.collapsedChildren.forEach(e=>{e.getData(c.eG).fireChange()})})},shouldMerge:()=>!1},D={...S,type:"deleteNode",inverse:e=>({...e,type:"addNode"}),apply:(e,t)=>{let n=t.get(h.L4).getNode(e.value.node.id);n&&n.dispose()},getLabel:(e,t)=>{let n=t.get(x);return`Delete Node ${n.getNodeLabel(e.value.node)}`},getDescription:(e,t)=>{let n=t.get(x),o=`Delete Node ${n.getNodeLabel(e.value.node)}`;return e.value.node.meta?.position&&(o+=` at ${e.value.node.meta.position.x},${e.value.node.meta.position.y}`),o}},I={...S,type:"deleteLine",inverse:e=>({...e,type:"addLine"}),apply:(e,t)=>{t.get(h.L4).removeNode(e.value.id)},getLabel:(e,t)=>"Delete Line",getDescription:(e,t)=>{let n=t.get(x),{value:o}=e;if(!o.from||!o.to)return"Delete Line";let r=n.getNodeLabelById(o.from),i=n.getNodeLabelById(o.to);return`Delete Line from ${r} to ${i}`}},C={...S,type:"changeNodeData",inverse:e=>({...e,value:{...e.value,value:e.value.oldValue,oldValue:e.value.value}}),apply:(e,t)=>{let n=t.get(h.L4).getNode(e.value.id);if(!n)return;let o=n.getData(d.Ps);if(!o)return;let{path:r}=e.value;r.endsWith("/")&&"/"!==r&&(r=r.slice(0,-1)),!r.startsWith("/")&&(r=`/${r}`);let i=o.formModel.getFormItemByPath(r);if(!!i)i.value=e.value.value},shouldMerge:(e,t,n)=>{if(!t)return!1;if(Date.now()-n.getTimestamp()<500)return e.type!==t.type||e.value.id!==t.value.id||e.value?.path!==t.value?.path||{type:e.type,value:{...e.value,value:e.value.value,oldValue:t.value.oldValue}};return!1}},O={...S,type:"addNode",inverse:e=>({...e,type:"deleteNode"}),apply:async(e,t)=>{let n=t.get(h.L4);await n.createWorkflowNode((0,a.cloneDeep)(e.value.node),!1,e.value.parentID)},getLabel:(e,t)=>{let n=t.get(x);return`Create Node ${n.getNodeLabel(e.value.node)}`},getDescription:(e,t)=>{let n=t.get(x),o=`Create Node ${n.getNodeLabel(e.value.node)}`;return e.value.node.meta?.position&&(o+=` at ${e.value.node.meta.position.x},${e.value.node.meta.position.y}`),o}},T=[{...S,type:"addLine",inverse:e=>({...e,type:"deleteLine"}),apply:(e,t)=>{t.get(h.dm).createLine({...e.value,key:e.value.id})},getLabel:(e,t)=>"Create Line",getDescription:(e,t)=>{let n=t.get(x),{value:o}=e;if(!o.from||!o.to)return"Create Line";let r=n.getNodeLabelById(o.from),i=n.getNodeLabelById(o.to);return`Create Line from ${r} to ${i}`}},I,O,D,C,M,k],_=class{registerOperationMeta(e){T.forEach(t=>{e.registerOperationMeta(t)})}};_=p([(0,s.b2)()],_);var A=class{constructor(){this._toDispose=new l.K4}onInit(e,t){let n=e.get(h.L4),o=e.get(i.qp),s=e.get(h.iw),l=e.get(h.ZO);t?.limit&&o.limit(t.limit),o.context.source=e,this._toDispose.pushAll([s.onNodesDrag(async e=>{if("onDragEnd"===e.type)this._dragNodesHandler.handle(e)}),n.onNodeCreate(({node:e,data:t})=>{let n=e.getData(r.WV);n&&this._entityManager.addEntityData(n)}),this._formManager.onFormModelWillInit(({model:e,data:t})=>{let n=e.flowNodeEntity,o=n.getData(d.Ps);o&&(this._entityManager.setValue(o,(0,a.cloneDeep)(t)),this._toDispose.push(o.onDetailChange(e=>{this._changeNodeDataHandler.handle({...e,node:n})})))}),n.onContentChange(async t=>{await this._changeContentHandler.handle(t,e)}),n.onReload(e=>{o.clear()}),l.onResetLayout(e=>{o.pushOperation({type:"resetLayout",value:{ids:e.nodeIds,value:e.positionMap,oldValue:e.oldPositionMap}},{noApply:!0})})])}dispose(){this._entityManager.dispose(),this._toDispose.dispose()}};p([(0,s.f3)(m)],A.prototype,"_dragNodesHandler",2),p([(0,s.f3)(v)],A.prototype,"_changeNodeDataHandler",2),p([(0,s.f3)(L)],A.prototype,"_changeContentHandler",2),p([(0,s.f3)(f)],A.prototype,"_entityManager",2),p([(0,s.f3)(d.yf)],A.prototype,"_formManager",2),A=p([(0,s.b2)()],A);var P=(0,r.M1)({onBind:({bind:e})=>{(0,r.KV)(e,_,[i.FU]),e(x).toSelf().inSingletonScope(),e(A).toSelf().inSingletonScope(),e(f).toSelf().inSingletonScope(),e(m).toSelf().inSingletonScope(),e(v).toSelf().inSingletonScope(),e(L).toSelf().inSingletonScope()},onInit(e,t){if(e.get(x).init(e,t),!!t.enable)e.get(A).onInit(e,t)},onDispose(e){e.get(f).dispose()},containerModules:[i.Xn]})},357897:function(e,t,n){n.d(t,{J2:function(){return M},Jb:function(){return v}});var o,r=n(89802),i=n(908600),a=n(65881),s=n(682264),l=n(213153),d=n(325458),h=n(461932),c=n(177783),u=n(817750),g=n(564085),p=Object.defineProperty,f=Object.getOwnPropertyDescriptor,y=(e,t,n,o)=>{for(var r=o>1?void 0:o?f(t,n):t,i,a=e.length-1;a>=0;a--)(i=e[a])&&(r=(o?i(t,n,r):i(r))||r);return o&&r&&p(t,n,r),r},m=d.ZP.div`
  width: 20px;
  height: 20px;
  border-radius: 50%;
  margin-top: -10px;
  margin-left: -10px;
  left: 50%;
  top: 50%;
  position: absolute;
  // 非 hover 状态下的样式
  border: none;

  & > .symbol {
    opacity: 0;
  }

  .bg-circle {
    display: flex;
    align-items: center;
    justify-content: center;
    position: absolute;
    border-radius: 50%;
    width: 20px;
    height: 20px;
    background-color: #fff;
    transform: scale(0.5);
    transition: all 0.2s linear 0s;
  }

  .bg {
    display: flex;
    align-items: center;
    justify-content: center;
    position: relative;
    width: 100%;
    height: 100%;
    border-radius: 50%;
    background: #9197F1;
    transform: scale(0.4, 0.4);
    transition: all 0.2s linear 0s;

    &.hasError {
      background: red;
    }

    .symbol {
      position: absolute;
      width: 14px;
      height: 14px;
      opacity: 0;
      pointer-events: none;
      color: #fff;
      transition: opacity 0.2s linear 0s;

      & > svg {
        width: 14px;
        height: 14px;
      }
    }

    .focus-circle {
      position: absolute;
      display: flex;
      justify-content: center;
      align-items: center;
      width: 8px;
      height: 8px;
      opacity: 0;
      background: #9197f1;
      border-radius: 50%;
      transition: opacity 0.2s linear 0s;
    }
  }

  &.linked .bg:not(.hasError) {
    background: #4d53e8;
  }

  &.hovered .bg:not(.hasError) {
    border: none;
    cursor: crosshair;
    transform: scale(1, 1);
    background: #4d53e8;

    & > .symbol {
      opacity: 1;
    }
  }

  .cross-hair {
    position: relative;
    left: 2px;
    top: 2px;

    &::after,
    &::before {
      content: '';
      background: #fff;
      border-radius: 2px;
      position: absolute;
    }

    &::after {
      left: 4px;
      width: 2px;
      height: 6px;
      box-shadow: 0 4px #fff;
    }

    &::before {
      top: 4px;
      width: 6px;
      height: 2px;
      box-shadow: 4px 0 #fff;
    }
`;function x(){return i.createElement("div",{className:"symbol"},i.createElement("div",{className:"cross-hair"}))}var v=i.memo(e=>{let t=(0,l.G2)(s.XH),n=(0,l.G2)(s.dm),{entity:o,onClick:d}=e,{portType:h,relativePosition:c,disabled:u}=o,[g,p]=(0,i.useState)(o.targetElement),[f,y]=(0,i.useState)(c.x),[v,b]=(0,i.useState)(c.y),[E,w]=(0,i.useState)(!1),[N,L]=(0,i.useState)(!!o?.lines?.length),[S,M]=(0,i.useState)(e.entity.hasError),k=(0,s.gO)();(0,i.useEffect)(()=>{o.validate(),M(o.hasError);let e=o.onEntityChange(()=>{if(o.targetElement){o.targetElement!==g&&p(o.targetElement);return}let e=o.relativePosition;y(Math.round(e.x)),b(Math.round(e.y))}),r=t.onHoveredChange(e=>{w(t.isHovered(o.id))}),i=o.onErrorChanged(()=>{M(o.hasError)}),a=n.onAvailableLinesChange(()=>{setTimeout(()=>{!n.disposed&&!o.disposed&&L(!!o.lines.length)},0)});return()=>{e.dispose(),r.dispose(),i.dispose(),a.dispose()}},[t,o,g]);let D=(0,a.Z)(e.className||"",{hovered:!k&&E&&!u&&"input"!==h,linked:N}),I=i.createElement(m,{className:D,style:g?e.style:{...e.style,left:f,top:v},onClick:d,"data-port-entity-id":o.id,"data-port-entity-type":o.portType,"data-testid":"sdk.workflow.canvas.node.port"},i.createElement("div",{className:(0,a.Z)("bg-circle","workflow-bg-circle")}),i.createElement("div",{className:(0,a.Z)({bg:!0,"workflow-port-bg":!0,"workflow-point-bg":!0,hasError:S})},i.createElement(x,null)),i.createElement("div",{className:"focus-circle"}));return g?r.createPortal(I,g):I}),b=d.ZP.div.attrs({className:"gedit-flow-activity-edge"})`
  position: absolute;

  @keyframes flowingDash {
    to {
      stroke-dashoffset: -13;
    }
  }

  .dashed-line {
    stroke-dasharray: 8, 5;
  }

  .flowing-line {
    animation: flowingDash 0.5s linear infinite;
  }
`;function E({id:e,pos:t,reverseArrow:n,strokeWidth:o,vertical:r,hide:a}){if(a)return null;let s=r?n?`M ${t.x-6},${t.y} L ${t.x},${t.y-6} L ${t.x+6},${t.y}`:`M ${t.x-6},${t.y-6} L ${t.x},${t.y} L ${t.x+6},${t.y-6}`:n?`M ${t.x},${t.y+6} L ${t.x-6},${t.y} L ${t.x},${t.y-6}`:`M ${t.x-6},${t.y-6} L ${t.x},${t.y} L ${t.x-6},${t.y+6}`;return i.createElement("path",{d:s,strokeLinecap:"round",stroke:`url(#${e})`,fill:"none",strokeWidth:o})}var w=(0,i.memo)(e=>{let{line:t,color:n,selected:o,children:r,strokePrefix:l}=e,{position:d,reverse:h,vertical:c,hideArrow:u}=t,{bounds:g,path:p}=t.getData(s.ps),f=e=>({x:e.x-g.x+12,y:e.y-g.y+12}),y=f(d.from),m=f(d.to),x=c?{x:m.x,y:m.y-s.em}:{x:m.x-s.em,y:m.y},v=c?{x:y.x,y:y.y+s.em+6}:{x:y.x+s.em+6,y:y.y},w=o?3:2,N=l?`${l}-${t.id}`:t.id,L=i.createElement("path",{d:p,fill:"none",stroke:`url(#${N})`,strokeWidth:w,className:(0,a.Z)(t.className,!t.className&&(t.processing||t.flowing?"dashed-line flowing-line":""))});return i.createElement(b,{style:{left:g.x-12,top:g.y-12,position:"absolute"}},r,i.createElement("svg",{width:g.width+24,height:g.height+24},i.createElement("defs",null,i.createElement("linearGradient",{x1:c?"100%":"0%",y1:c?"0%":"100%",x2:"100%",y2:"100%",id:N,gradientUnits:"userSpaceOnUse"},i.createElement("stop",{stopColor:n,offset:"0%"}),i.createElement("stop",{stopColor:n,offset:"100%"}))),i.createElement("g",null,L,i.createElement(E,{id:N,reverseArrow:h,pos:h?v:x,strokeWidth:w,vertical:c,hide:u}))))},(e,t)=>e.version===t.version),N=class extends l.mh{constructor(){super(...arguments),this.layerID=(0,s.x0)(),this.mountedLines=new Map,this._version=0,this.node=c.xF.createDivWithClass("gedit-playground-layer gedit-flow-lines-layer")}onZoom(e){this.node.style.transform=`scale(${e})`}onReady(){this.pipelineNode.appendChild(this.node),this.toDispose.pushAll([this.selectService.onSelectionChanged(()=>this.render()),this.hoverService.onHoveredChange(()=>this.render()),this.workflowDocument.linesManager.onForceUpdate(()=>{this.mountedLines.clear(),this.bumpVersion(),this.render()})])}dispose(){this.mountedLines.clear()}render(){let[,e]=(0,i.useState)({});(0,i.useLayoutEffect)(()=>{let t=requestAnimationFrame(()=>{let t=!1;this.lines.forEach(e=>{let n=e.getData(s.ps),o=n.renderVersion;n.update(),n.renderVersion!==o&&(t=!0)}),t&&e({})});return()=>cancelAnimationFrame(t)},[this.lines]);let t=this.lines.map(e=>this.renderLine(e));return i.createElement(i.Fragment,null,t)}bumpVersion(){this._version=this._version+1,this._version===Number.MAX_SAFE_INTEGER&&(this._version=0)}lineProps(e){let{renderVersion:t}=e.getData(s.ps),{lineType:n}=this.workflowDocument.linesManager,o=this.selectService.isSelected(e.id),{version:r,color:i}=e,a=`${this._version}:${r}:${t}:${i}:${o}`;return{key:e.id,color:e.color,selected:o,line:e,lineType:n,version:a,strokePrefix:this.layerID}}lineComponent(e){let t=this.options.renderInsideLine??(()=>i.createElement(i.Fragment,null));return i.createElement(w,{...e},i.createElement(t,{...e}))}renderLine(e){let t=this.lineProps(e),n=this.mountedLines.get(e.id),o=void 0!==n,{portal:i,version:a}=n??{};if(o&&a===t.version)return i;!o&&(this.renderElement.appendChild(e.node),e.onDispose(()=>{this.mountedLines.delete(e.id),e.node.remove()}));let s=r.createPortal(this.lineComponent(t),e.node);return this.mountedLines.set(e.id,{line:e,portal:s,version:t.version}),s}get renderElement(){return this.stackContext.node}};N.type="WorkflowLinesLayer",y([(0,h.f3)(s.XH)],N.prototype,"hoverService",2),y([(0,h.f3)(s.oJ)],N.prototype,"selectService",2),y([(0,h.f3)(u.StackingContextManager)],N.prototype,"stackContext",2),y([(0,l.RX)(s.e2)],N.prototype,"lines",2),y([(0,l.RX)(s.FD)],N.prototype,"ports",2),y([(0,l.aI)(s.CT,l.VO)],N.prototype,"trans",2),y([(0,h.f3)(s.L4)],N.prototype,"workflowDocument",2),N=y([(0,h.b2)()],N);var L=class{constructor(e){this.entity=e}get path(){return this.data?.path??""}calcDistance(e){return this.data?c.E9.getDistance(e,this.data.bezier.project(e)):Number.MAX_SAFE_INTEGER}get bounds(){return this.data?this.data.bbox:new c.Ae}update(e){this.data=this.calcBezier(e.fromPos,e.toPos)}calcBezier(e,t){let n=this.entity.vertical?function(e,t){let n,o;let r=c.Ae.createRectangleWithTwoPoints(e,t);switch(n=e.y<=t.y?e.x<=t.x?1:3:e.x<=t.x?0:2){case 1:o=[{x:r.leftTop.x,y:r.leftTop.y+r.height/2},{x:r.rightBottom.x,y:r.rightBottom.y-r.height/2}];break;case 3:o=[{x:r.rightTop.x,y:r.rightTop.y+r.height/2},{x:r.leftBottom.x,y:r.leftBottom.y-r.height/2}];break;case 0:o=[{x:r.leftBottom.x,y:r.leftBottom.y+Math.min(r.height,300)},{x:r.rightTop.x,y:r.rightTop.y-Math.min(r.height,300)}];break;case 2:o=[{x:r.rightBottom.x,y:r.rightBottom.y+Math.min(r.height,300)},{x:r.leftTop.x,y:r.leftTop.y-Math.min(r.height,300)}]}return o}(e,t):function(e,t){let n,o;let r=c.Ae.createRectangleWithTwoPoints(e,t);switch(n=e.x<=t.x?e.y<=t.y?1:0:e.y<=t.y?3:2){case 0:o=[{x:r.rightBottom.x-r.width/2,y:r.rightBottom.y},{x:r.leftTop.x+r.width/2,y:r.leftTop.y}];break;case 1:o=[{x:r.rightTop.x-r.width/2,y:r.rightTop.y},{x:r.leftBottom.x+r.width/2,y:r.leftBottom.y}];break;case 2:o=[{x:r.rightBottom.x+Math.min(r.width,300),y:r.rightBottom.y},{x:r.leftTop.x-Math.min(r.width,300),y:r.leftTop.y}];break;case 3:o=[{x:r.rightTop.x+Math.min(r.width,300),y:r.rightTop.y},{x:r.leftBottom.x-Math.min(r.width,300),y:r.leftBottom.y}]}return o}(e,t),o=new g.D([e,...n,t]),r=o.bbox(),i=new c.Ae(r.x.min,r.y.min,r.x.max-r.x.min,r.y.max-r.y.min),a=this.getPath({bbox:i,fromPos:e,toPos:t,controls:n});return this.data={fromPos:e,toPos:t,bezier:o,bbox:i,controls:n,path:a},this.data}getPath(e){let{bbox:t}=e,n=e=>({x:e.x-t.x+12,y:e.y-t.y+12}),o=n(e.fromPos),r=n(e.toPos),i=e.controls.map(e=>n(e)),a=this.entity.vertical?{x:r.x,y:r.y-s.em}:{x:r.x-s.em,y:r.y};return(()=>{let e=i.map(e=>`${e.x} ${e.y}`).join(","),t=1===i.length?"S":"C";return this.entity.vertical?`M${o.x} ${o.y+s.em} ${t} ${e}, ${a.x} ${a.y}`:`M${o.x+s.em} ${o.y} ${t} ${e}, ${a.x} ${a.y}`})()}};L.type=s.SP.BEZIER;(e=>{let t=({source:e,target:t})=>e.x<t.x?{x:1,y:0}:{x:-1,y:0};e.getPoints=function({source:e,target:n,vertical:o=!1}){let r,i;let a=o?{x:0,y:1}:{x:1,y:0},s=o?{x:0,y:-1}:{x:-1,y:0},l={x:e.x+20*a.x,y:e.y+20*a.y},d={x:n.x+20*s.x,y:n.y+20*s.y},h=o?{x:0,y:l.y<d.y?1:-1}:t({source:l,target:d}),c=0!==h.x?"x":"y",u=h[c],g=[],[p,f]=function({source:e,target:t}){let n=Math.abs(t.x-e.x)/2,o=t.x<e.x?t.x+n:t.x-n,r=Math.abs(t.y-e.y)/2;return[o,t.y<e.y?t.y+r:t.y-r]}({source:e,target:n});if(a[c]*s[c]==-1){r=p,i=f;let e=[{x:r,y:l.y},{x:r,y:d.y}],t=[{x:l.x,y:i},{x:d.x,y:i}];g=a[c]===u?"x"===c?e:t:"x"===c?t:e}else{let e=[{x:l.x,y:d.y}],t=[{x:d.x,y:l.y}];g="x"===c?a.x===u?t:e:a.y===u?e:t;let n="x"===c?"y":"x",o=a[c]===s[n],h=l[n]>d[n],p=l[n]<d[n];(1===a[c]&&(!o&&h||o&&p)||1!==a[c]&&(!o&&p||o&&h))&&(g="x"===c?e:t);let f={x:l.x,y:l.y},y={x:d.x,y:d.y},m=Math.max(Math.abs(f.x-g[0].x),Math.abs(y.x-g[0].x));m>=Math.max(Math.abs(f.y-g[0].y),Math.abs(y.y-g[0].y))?(r=(f.x+y.x)/2,i=g[0].y):(r=g[0].x,i=(f.y+y.y)/2)}return[e,{x:l.x,y:l.y},...g,{x:d.x,y:d.y},n]};function n(e){let t=e.map(e=>e.x),n=e.map(e=>e.y),o=Math.min(...t),r=Math.max(...t),i=Math.min(...n),a=Math.max(...n);return c.Ae.createRectangleWithTwoPoints({x:o,y:i},{x:r,y:a})}e.getSmoothStepPath=function(e){return e.reduce((t,n,o)=>{let r="";return t+=r=o>0&&o<e.length-1?function(e,t,n){let o=Math.min(c.E9.getDistance(e,t)/2,c.E9.getDistance(t,n)/2,5),{x:r,y:i}=t;if(e.x===r&&r===n.x||e.y===i&&i===n.y)return`L${r} ${i}`;if(e.y===i){let t=e.x<n.x?-1:1,a=e.y<n.y?1:-1;return`L ${r+o*t},${i}Q ${r},${i} ${r},${i+o*a}`}let a=e.x<n.x?1:-1,s=e.y<n.y?-1:1;return`L ${r},${i+o*s}Q ${r},${i} ${r+o*a},${i}`}(e[o-1],n,e[o+1]):`${0===o?"M":"L"}${n.x} ${n.y}`},"")},e.getBounds=n;e.getFoldLineToPointDistance=function(e,t){return n(e).contains(t.x,t.y)?Math.min(...e.reduce((t,n,o)=>0===o?t:(t.push([e[o-1],n]),t),[]).map(e=>(function(e,t,n){let o;if(e.x-t.x==0)o=Math.abs(n.x-e.x);else{let r=(e.y-t.y)/(e.x-t.x),i=e.y-r*e.x;o=Math.abs((r*n.x+i-n.y)/Math.sqrt(r*r+1))}return o})(...e,t))):Math.min(...e.map(e=>c.E9.getDistance(e,t)))}})(o||(o={}));var S=class{constructor(e){this.entity=e}get path(){return this.data?.path??""}calcDistance(e){return this.data?o.getFoldLineToPointDistance(this.data.points,e):Number.MAX_SAFE_INTEGER}get bounds(){return this.data?this.data.bbox:new c.Ae}update(e){let{fromPos:t,toPos:n}=e,{vertical:r}=this.entity,i={x:r?0:s.em,y:r?s.em:0},a={x:r?0:-s.em,y:r?-s.em:0},l=o.getPoints({source:{x:t.x+i.x,y:t.y+i.y},target:{x:n.x+a.x,y:n.y+a.y},vertical:r}),d=o.getBounds(l),h=l.map(e=>({x:e.x-d.x+12,y:e.y-d.y+12})),c=o.getSmoothStepPath(h);this.data={points:l,path:c,bbox:d}}};S.type=s.SP.LINE_CHART;(class{constructor(e){this.entity=e}get path(){return this.data?.path??""}calcDistance(e){if(!this.data)return Number.MAX_SAFE_INTEGER;let[t,n]=this.data.points;return c.E9.getDistance(e,function(e,t,n){let o=n.x-t.x,r=n.y-t.y;if(0===o)return{x:t.x,y:e.y};if(0===r)return{x:e.x,y:t.y};let i=Math.max(0,Math.min(1,((e.x-t.x)*o+(e.y-t.y)*r)/(o*o+r*r)));return{x:t.x+i*o,y:t.y+i*r}}(e,t,n))}get bounds(){return this.data?this.data.bbox:new c.Ae}update(e){let{fromPos:t,toPos:n}=e,{vertical:o}=this.entity,r={x:o?0:s.em,y:o?s.em:0},i={x:o?0:-s.em,y:o?-s.em:0},a=[{x:t.x+r.x,y:t.y+r.y},{x:n.x+i.x,y:n.y+i.y}],l=c.Ae.createRectangleWithTwoPoints(a[0],a[1]),d=a.map(e=>({x:e.x-l.x+12,y:e.y-l.y+12})),h=`M ${d[0].x} ${d[0].y} L ${d[1].x} ${d[1].y}`;this.data={points:a,path:h,bbox:l}}}).type="WorkflowStraightLineContribution",(class{constructor(e){this.entity=e}get path(){return this.data?.path??""}calcDistance(e){if(!this.data)return Number.MAX_SAFE_INTEGER;let{fromPos:t,toPos:n,bbox:o}=this.data;if(!o.contains(e.x,e.y)){let t=Math.max(o.x-e.x,0,e.x-(o.x+o.width)),n=Math.max(o.y-e.y,0,e.y-(o.y+o.height));return Math.sqrt(t*t+n*n)}let r={x:(t.x+n.x)/2,y:(t.y+n.y)/2},i=c.E9.getDistance(t,r);return Math.abs(c.E9.getDistance(e,r)-i)}get bounds(){return this.data?this.data.bbox:new c.Ae}update(e){let{fromPos:t,toPos:n}=e,{vertical:o}=this.entity,r={x:o?0:s.em,y:o?s.em:0},i={x:o?0:-s.em,y:o?-s.em:0},a={x:t.x+r.x,y:t.y+r.y},l={x:n.x+i.x,y:n.y+i.y},d=this.calculateArcBBox(a,l),h=this.getArcPath(a,l,d);this.data={fromPos:a,toPos:l,path:h,bbox:d}}calculateArcBBox(e,t){let n=t.x-e.x,o=t.y-e.y,r=Math.sqrt(n*n+o*o)/2,i=(e.x+t.x)/2,a=(e.y+t.y)/2;return new c.Ae(i-r,a-r,2*r,2*r)}getArcPath(e,t,n){let o=t.x-e.x,r=t.y-e.y,i=Math.sqrt(o*o+r*r),a={x:e.x-n.x+12,y:e.y-n.y+12},s={x:t.x-n.x+12,y:t.y-n.y+12};return`M ${a.x} ${a.y} A ${i/2} ${i/2} 0 0 1 ${s.x} ${s.y}`}}).type="WorkflowArkLineContribution",(class{constructor(e){this.entity=e}get path(){return this.data?.path??""}calcDistance(e){return this.data?Math.min(...this.data.points.slice(1).map((t,n)=>{let o=this.data.points[n];return this.getDistanceToLineSegment(e,o,t)})):Number.MAX_SAFE_INTEGER}getDistanceToLineSegment(e,t,n){let o=n.x-t.x,r=n.y-t.y;if(0===o&&0===r)return c.E9.getDistance(e,t);let i=((e.x-t.x)*o+(e.y-t.y)*r)/(o*o+r*r);if(i<0)return c.E9.getDistance(e,t);if(i>1)return c.E9.getDistance(e,n);let a={x:t.x+i*o,y:t.y+i*r};return c.E9.getDistance(e,a)}get bounds(){return this.data?this.data.bbox:new c.Ae}update(e){let{fromPos:t,toPos:n}=e,{vertical:o}=this.entity,r={x:o?0:s.em,y:o?s.em:0},i={x:o?0:-s.em,y:o?-s.em:0},a=this.getManhattanPoints({source:{x:t.x+r.x,y:t.y+r.y},target:{x:n.x+i.x,y:n.y+i.y},vertical:o}),l=c.Ae.createRectangleWithTwoPoints(a.reduce((e,t)=>({x:Math.min(e.x,t.x),y:Math.min(e.y,t.y)}),a[0]),a.reduce((e,t)=>({x:Math.max(e.x,t.x),y:Math.max(e.y,t.y)}),a[0])),d=a.map(e=>({x:e.x-l.x+12,y:e.y-l.y+12})),h=this.getPathFromPoints(d);this.data={points:a,path:h,bbox:l}}getManhattanPoints(e){let{source:t,target:n,vertical:o}=e,r=[t];return o?(t.y!==n.y&&r.push({x:t.x,y:n.y}),t.x!==n.x&&r.push({x:n.x,y:n.y})):(t.x!==n.x&&r.push({x:n.x,y:t.y}),t.y!==n.y&&r.push({x:n.x,y:n.y})),r[r.length-1]!==n&&r.push(n),r}getPathFromPoints(e){return e.reduce((e,t,n)=>0===n?`M ${t.x} ${t.y}`:`${e} L ${t.x} ${t.y}`,"")}}).type="WorkflowManhattanLineContribution";var M=(0,l.M1)({onInit:(e,t)=>{e.playground.registerLayer(N,{...t})},onReady:(e,t)=>{let n=e.container.get(s.dm);n.registerContribution(L).registerContribution(S),t.contributions&&t.contributions.forEach(e=>{n.registerContribution(e)}),t.defaultLineType&&n.switchLineType(t.defaultLineType)}})},48243:function(e,t,n){n.d(t,{Z:function(){return b}});var o=n(213153),r=n(461932),i=n(215206),a=n(682264),s=n(177783),l=n(908600),d=Object.defineProperty,h=Object.getOwnPropertyDescriptor,c=(e,t,n,o)=>{for(var r=o>1?void 0:o?h(t,n):t,i,a=e.length-1;a>=0;a--)(i=e[a])&&(r=(o?i(t,n,r):i(r))||r);return o&&r&&d(t,n,r),r},u={enableEdgeSnapping:!0,edgeThreshold:7,enableGridSnapping:!1,gridSize:20,enableMultiSnapping:!1,enableOnlyViewportSnapping:!0,edgeColor:"#4E40E5",alignColor:"#4E40E5",edgeLineWidth:2,alignLineWidth:2,alignCrossWidth:16},g=(e,t)=>void 0!==e&&void 0!==t&&1e-5>Math.abs(e-t),p=(e,t)=>void 0!==e&&void 0!==t&&t-e>1e-5,f=(e,t)=>void 0!==e&&void 0!==t&&e-t>1e-5,y=(e,t)=>g(e,t)||p(e,t),m=e=>"number"==typeof e&&!isNaN(e),x=class{constructor(){this.disposers=[],this.snapEmitter=new s.Q5,this.onSnap=this.snapEmitter.event}init(e={}){this.options={...u,...e},this.mountListener()}dispose(){this.disposers.forEach(e=>e.dispose())}mountListener(){let e=this.dragService.registerPosAdjuster(e=>this.snapping({targetNodes:e.selectedNodes,position:e.position})),t=this.dragService.onNodesDrag(e=>{if("onDragEnd"===e.type)this.options.enableGridSnapping&&this.gridSnapping({targetNodes:e.nodes,gridSize:this.options.gridSize}),this.options.enableEdgeSnapping&&this.clear()});this.disposers.push(e,t)}snapping(e){let{targetNodes:t,position:n}=e,o=!this.options.enableMultiSnapping&&1!==t.length;if(!this.options.enableEdgeSnapping||o)return{x:0,y:0};let r=this.getBounds(t),i=new s.Ae(n.x,n.y,r.width,r.height),a=this.getSnapNodeRects({targetNodes:t,targetRect:i}),{alignOffset:l,alignRects:d,alignSpacing:h}=this.calcAlignOffset({targetRect:i,alignThreshold:this.options.edgeThreshold,snapNodeRects:a}),{snapOffset:c,snapEdgeLines:u}=this.calcSnapOffset({targetRect:i,edgeThreshold:this.options.edgeThreshold,snapNodeRects:a}),g={x:c.x||l.x,y:c.y||l.y},p=new s.Ae(n.x+g.x,n.y+g.y,i.width,i.height);return this.snapEmitter.fire({snapRect:p,snapEdgeLines:u,alignRects:d,alignSpacing:h}),g}calcSnapOffset(e){let{snapNodeRects:t,edgeThreshold:n,targetRect:o}=e,r=this.getSnapLines({snapNodeRects:t}),i=r.horizontal.find(e=>y(Math.abs(e.y-o.top),n)),a=r.horizontal.find(e=>y(Math.abs(e.y-o.bottom),n)),s=r.vertical.find(e=>y(Math.abs(e.x-o.left),n)),l=r.vertical.find(e=>y(Math.abs(e.x-o.right),n)),d=r.midHorizontal.find(e=>y(Math.abs(e.y-o.center.y),n)),h=r.midVertical.find(e=>y(Math.abs(e.x-o.center.x),n)),c=i?.y,u=m(a?.y)?a.y-o.height:void 0,p=s?.x,f=m(l?.x)?l.x-o.width:void 0,x=m(d?.y)?d.y-o.height/2:void 0,v=m(h?.x)?h.x-o.width/2:void 0,b={x:v??p??f??o.x,y:x??c??u??o.y},E={x:b.x-o.x,y:b.y-o.y};return{snapOffset:E,snapEdgeLines:{top:g(c,b.y)?i:void 0,bottom:g(u,b.y)?a:void 0,left:g(p,b.x)?s:void 0,right:g(f,b.x)?l:void 0,midVertical:g(v,b.x)?h:void 0,midHorizontal:g(x,b.y)?d:void 0}}}gridSnapping(e){let{gridSize:t,targetNodes:n}=e,o=this.getBounds(n),r=e=>Math.round(e/t)*t,i={x:r(o.x),y:r(o.y)},a={x:i.x-o.x,y:i.y-o.y};n.forEach(e=>this.updateNodePositionWithOffset({node:e,offset:a}))}clear(){this.snapEmitter.fire({snapEdgeLines:{},snapRect:s.Ae.EMPTY,alignRects:{top:[],bottom:[],left:[],right:[]},alignSpacing:{}})}getSnapLines(e){let{snapNodeRects:t}=e,n=[],o=[],r=[],i=[];return t.forEach(e=>{let t=e.rect,a=t.center,s={y:t.top,sourceNodeId:e.id},l={y:t.bottom,sourceNodeId:e.id},d={x:t.left,sourceNodeId:e.id},h={x:t.right,sourceNodeId:e.id},c={y:a.y,sourceNodeId:e.id},u={x:a.x,sourceNodeId:e.id};n.push(s,l),o.push(d,h),r.push(c),i.push(u)}),{horizontal:n,vertical:o,midHorizontal:r,midVertical:i}}getAvailableNodes(e){let{targetNodes:t,targetRect:n}=e,o=n.center,r=t[0].parent?.id??this.document.root.id,a=t.map(e=>e.id);return a.push(i.Sy.ROOT),this.nodes.filter(e=>e.parent?.id===r).filter(e=>!a.includes(e.id)).sort((e,t)=>{let n=e.getData(i.eG).bounds.center,r=t.getData(i.eG).bounds.center,a=Math.abs(n.x-o.x)+Math.abs(n.y-o.y);return a-(Math.abs(r.x-o.x)+Math.abs(r.y-o.y))})}viewRect(){let{width:e,height:t,scrollX:n,scrollY:o,zoom:r}=this.playgroundConfig.config;return new s.Ae(n/r,o/r,e/r,t/r)}getSnapNodeRects(e){let t=this.getAvailableNodes(e),n=this.viewRect();return t.map(e=>{let t={id:e.id,rect:e.getData(i.eG).bounds,entity:e};if(!this.options.enableOnlyViewportSnapping||e.parent?.flowNodeType!==i.Sy.ROOT||!!s.Ae.intersects(n,t.rect))return t}).filter(Boolean)}get nodes(){return this.entityManager.getEntities(a.CT)}getBounds(e){return 0===e.length?s.Ae.EMPTY:s.Ae.enlarge(e.map(e=>e.getData(i.eG).bounds))}updateNodePositionWithOffset(e){let{node:t,offset:n}=e,r=t.getData(o.VO),a={x:r.position.x+n.x,y:r.position.y+n.y};t.collapsedChildren?.length>0&&t.collapsedChildren.forEach(e=>{e.getData(i.eG).fireChange()}),r.update({position:a})}calcAlignOffset(e){let t,n,o,r,i,a;let{snapNodeRects:s,targetRect:l,alignThreshold:d}=e,h=this.getAlignRects({targetRect:l,snapNodeRects:s}),c=this.calcAlignSpacing({targetRect:l,alignRects:h});if(c.top){let e=h.top[0].rect.bottom+c.top;y(Math.abs(l.top-e),d)?t=e:c.top=void 0}if(c.bottom){let e=h.bottom[0].rect.top-c.bottom;p(Math.abs(l.bottom-e),d)?n=e-l.height:c.bottom=void 0}if(c.left){let e=h.left[0].rect.right+c.left;y(Math.abs(l.left-e),d)?o=e:c.left=void 0}if(c.right){let e=h.right[0].rect.left-c.right;y(Math.abs(l.right-e),d)?r=e-l.width:c.right=void 0}if(c.midHorizontal){let e=h.left[0].rect.right+c.midHorizontal;y(Math.abs(l.left-e),d)?a=e:c.midHorizontal=void 0}if(c.midVertical){let e=h.top[0].rect.bottom+c.midVertical;y(Math.abs(l.top-e),d)?i=e:c.midVertical=void 0}let u={x:a??o??r??l.x,y:i??t??n??l.y};return{alignOffset:{x:u.x-l.x,y:u.y-l.y},alignRects:h,alignSpacing:c}}calcAlignSpacing(e){let{targetRect:t,alignRects:n}=e,o=this.getDirectionAlignSpacing({rects:n.top,isHorizontal:!1}),r=this.getDirectionAlignSpacing({rects:n.bottom,isHorizontal:!1}),i=this.getDirectionAlignSpacing({rects:n.left,isHorizontal:!0}),a=this.getDirectionAlignSpacing({rects:n.right,isHorizontal:!0}),s=this.getMidAlignSpacing({rectA:n.left[0]?.rect,rectB:n.right[0]?.rect,targetRect:t,isHorizontal:!0});return{top:o,bottom:r,left:i,right:a,midHorizontal:s,midVertical:this.getMidAlignSpacing({rectA:n.top[0]?.rect,rectB:n.bottom[0]?.rect,targetRect:t,isHorizontal:!1})}}getAlignRects(e){let{targetRect:t,snapNodeRects:n}=e,o=[],r=[],i=[],a=[];return n.forEach(e=>{let n=e.rect,{isVerticalIntersection:s,isHorizontalIntersection:l,isIntersection:d}=this.intersection(n,t);if(!d)s?f(n.center.y,t.center.y)?r.push({rect:n,sourceNodeId:e.id}):o.push({rect:n,sourceNodeId:e.id}):l&&(f(n.center.x,t.center.x)?a.push({rect:n,sourceNodeId:e.id}):i.push({rect:n,sourceNodeId:e.id}))}),{top:o,bottom:r,left:i,right:a}}getMidAlignSpacing(e){let{rectA:t,rectB:n,targetRect:o,isHorizontal:r}=e;if(!t||!n)return;let{isVerticalIntersection:i,isHorizontalIntersection:a,isIntersection:s}=this.intersection(t,n);return s?void 0:r&&a&&!i?(Math.min(Math.abs(t.left-n.right),Math.abs(t.right-n.left))-o.width)/2:r||!i||a?void 0:(Math.min(Math.abs(t.top-n.bottom),Math.abs(t.bottom-n.top))-o.height)/2}getDirectionAlignSpacing(e){let{rects:t,isHorizontal:n}=e;if(t.length<2)return;let o=t[0].rect,r=t[1].rect,{isVerticalIntersection:i,isHorizontalIntersection:a,isIntersection:s}=this.intersection(o,r);return s?void 0:n&&a&&!i?Math.min(Math.abs(o.left-r.right),Math.abs(o.right-r.left)):n||!i||a?void 0:Math.min(Math.abs(o.top-r.bottom),Math.abs(o.bottom-r.top))}intersection(e,t){let n=p(e.left,t.right)&&f(e.right,t.left),o=p(e.top,t.bottom)&&f(e.bottom,t.top);return{isHorizontalIntersection:o,isVerticalIntersection:n,isIntersection:o&&n}}};c([(0,r.f3)(a.L4)],x.prototype,"document",2),c([(0,r.f3)(o.v2)],x.prototype,"entityManager",2),c([(0,r.f3)(a.iw)],x.prototype,"dragService",2),c([(0,r.f3)(o.ER)],x.prototype,"playgroundConfig",2),x=c([(0,r.b2)()],x);var v=class extends o.mh{constructor(){super(...arguments),this.node=s.xF.createDivWithClass("gedit-playground-layer gedit-flow-snap-layer"),this.edgeLines=[],this.alignLines=[]}onReady(){this.node.style.zIndex="9999",this.toDispose.pushAll([this.service.onSnap(e=>{this.edgeLines=this.calcEdgeLines(e),this.alignLines=this.calcAlignLines(e),this.render()})])}render(){return l.createElement(l.Fragment,null,this.alignLines.length>0&&l.createElement("div",{className:"workflow-snap-align-lines"},this.renderAlignLines()),this.edgeLines.length>0&&l.createElement("div",{className:"workflow-snap-edge-lines"},this.renderEdgeLines()))}onZoom(e){this.node.style.transform=`scale(${e})`}renderEdgeLines(){return this.edgeLines.map(e=>{let{className:t,sourceNode:n,top:o,left:r,width:i,height:a,dashed:s}=e,d=`${t}-${n}-${o}-${r}-${i}-${a}`,h=i<a,c=`${this.options.edgeLineWidth}px ${s?"dashed":"solid"} ${this.options.edgeColor}`;return l.createElement("div",{className:`workflow-snap-edge-line ${t}`,"data-testid":"sdk.workflow.canvas.snap.edgeLine","data-snap-line-id":d,"data-snap-line-sourceNode":n,key:d,style:{top:o,left:r,width:i,height:a,position:"absolute",borderLeft:h?c:"none",borderTop:h?"none":c}})})}renderAlignLines(){return this.alignLines.map(e=>{let t=`${e.className}-${e.sourceNode}-${e.top}-${e.left}-${e.width}-${e.height}`,n=f(e.width,e.height),o=this.options.alignLineWidth,r=this.options.alignCrossWidth,i=n?e.top-o/2:e.top,a=n?e.left:e.left-o/2;return l.createElement("div",{className:`workflow-snap-align-line ${e.className}`,"data-testid":"sdk.workflow.canvas.snap.alignLine","data-snap-line-id":t,"data-snap-line-sourceNode":e.sourceNode,key:t,style:{position:"absolute"}},l.createElement("div",{style:{position:"absolute",top:i,left:a,width:n?e.width:o,height:n?o:e.height,backgroundColor:this.options.alignColor}}),l.createElement("div",{style:{position:"absolute",top:n?i-(r-o)/2:i,left:n?a:a-(r-o)/2,width:n?o:r,height:n?r:o,backgroundColor:this.options.alignColor}}),l.createElement("div",{style:{position:"absolute",top:n?i-(r-o)/2:i+e.height-o,left:n?a+e.width-o:a-(r-o)/2,width:n?o:r,height:n?r:o,backgroundColor:this.options.alignColor}}))})}calcEdgeLines(e){let{alignRects:t,snapRect:n,snapEdgeLines:o}=e,r=[],a=this.directionFullAlign({alignRects:t.top,targetRect:n,isVertical:!0}),s=this.directionFullAlign({alignRects:t.bottom,targetRect:n,isVertical:!0}),l=this.directionFullAlign({alignRects:t.left,targetRect:n,isVertical:!1}),d=this.directionFullAlign({alignRects:t.right,targetRect:n,isVertical:!1});if(a){let e=a.rect.top,t=s?n.bottom-n.height/2-e:n.bottom-e,o={top:e,width:this.options.edgeLineWidth,height:t};r.push({className:"edge-full-top-left",sourceNode:a.sourceNodeId,left:n.left,...o}),r.push({className:"edge-full-top-right",sourceNode:a.sourceNodeId,left:n.right,...o}),r.push({className:"edge-full-top-mid",sourceNode:a.sourceNodeId,left:n.left+n.width/2,dashed:!0,...o})}if(s){let e=a?n.top+n.height/2:n.top,t=s.rect.bottom-e,o={top:e,width:this.options.edgeLineWidth,height:t};r.push({className:"edge-full-bottom-left",sourceNode:s.sourceNodeId,left:n.left,...o}),r.push({className:"edge-full-bottom-right",sourceNode:s.sourceNodeId,left:n.right,...o}),r.push({className:"edge-full-bottom-mid",sourceNode:s.sourceNodeId,left:n.left+n.width/2,dashed:!0,...o})}if(l){let e=l.rect.left,t=d?n.right-n.width/2-e:n.right-e,o={left:e,width:t,height:this.options.edgeLineWidth};r.push({className:"edge-full-left-top",sourceNode:l.sourceNodeId,top:n.top,...o}),r.push({className:"edge-full-left-bottom",sourceNode:l.sourceNodeId,top:n.bottom,...o}),r.push({className:"edge-full-left-mid",sourceNode:l.sourceNodeId,top:n.top+n.height/2,dashed:!0,...o})}if(d){let e=l?n.left+n.width/2:n.left,t=d.rect.right-e,o={left:e,width:t,height:this.options.edgeLineWidth};r.push({className:"edge-full-right-top",sourceNode:d.sourceNodeId,top:n.top,...o}),r.push({className:"edge-full-right-bottom",sourceNode:d.sourceNodeId,top:n.bottom,...o}),r.push({className:"edge-full-right-mid",sourceNode:d.sourceNodeId,top:n.top+n.height/2,dashed:!0,...o})}let h=Object.entries(o).map(([e,t])=>{if(!t)return;let o=this.document.getNode(t.sourceNodeId);if(!o)return;let r=o.getData(i.eG).bounds;if(m(t.x)){let o=Math.min(r.top,n.top),i=Math.max(r.bottom,n.bottom),l=t.x,d=this.options.edgeLineWidth,h={className:`edge-snapped-${e}`,sourceNode:t.sourceNodeId,top:o,left:l,width:d,height:i-o,dashed:"midVertical"===e},c=o===r.top;if(c&&a||!c&&s)return;return h}if(m(t.y)){let o=Math.min(r.left,n.left),i=Math.max(r.right,n.right),a=t.y,s=this.options.edgeLineWidth,h={className:`edge-snapped-${e}`,sourceNode:t.sourceNodeId,top:a,left:o,width:i-o,height:s,dashed:"midHorizontal"===e},c=o===r.left;if(c&&l||!c&&d)return;return h}}).filter(Boolean);return r.push(...h),r}directionFullAlign(e){let{alignRects:t,targetRect:n,isVertical:o}=e,r=-1;for(let e=0;e<t.length;e++){let i=t[e],a=t[e-1]?.rect??n;if(!this.rectFullAlign(i.rect,a,o))break;r=e}return t[r]}rectFullAlign(e,t,n){return n?g(e.left,t.left)&&g(e.right,t.right):g(e.top,t.top)&&g(e.bottom,t.bottom)}calcAlignLines(e){let{alignRects:t,alignSpacing:n,snapRect:o}=e,r=this.calcDirectionAlignLines({alignRects:t.top,targetRect:o,isVertical:!0,spacing:n.midVertical??n.top}),i=this.calcDirectionAlignLines({alignRects:t.bottom,targetRect:o,isVertical:!0,spacing:n.midVertical??n.bottom}),a=this.calcDirectionAlignLines({alignRects:t.left,targetRect:o,isVertical:!1,spacing:n.midHorizontal??n.left});return[...r,...i,...a,...this.calcDirectionAlignLines({alignRects:t.right,targetRect:o,isVertical:!1,spacing:n.midHorizontal??n.right})]}calcDirectionAlignLines(e){let{alignRects:t,targetRect:n,isVertical:o,spacing:r}=e,i=[];if(!r)return i;for(let e=0;e<t.length;e++){let a=t[e],s=a.rect,l=t[e-1]?.rect??n;if(!g(o?Math.min(Math.abs(l.top-s.bottom),Math.abs(l.bottom-s.top)):Math.min(Math.abs(l.left-s.right),Math.abs(l.right-s.left)),r))break;if(o){let e=this.calcHorizontalIntersectionCenter(s,n);i.push({className:"align-vertical",sourceNode:a.sourceNodeId,top:Math.min(s.bottom,l.bottom),left:e,width:1,height:r})}else{let e=this.calcVerticalIntersectionCenter(s,n);i.push({className:"align-horizontal",sourceNode:a.sourceNodeId,top:e,left:Math.min(s.right,l.right),width:r,height:1})}}return i}calcVerticalIntersectionCenter(e,t){let n=Math.max(e.top,t.top);return(n+Math.min(e.bottom,t.bottom))/2}calcHorizontalIntersectionCenter(e,t){let n=Math.max(e.left,t.left);return(n+Math.min(e.right,t.right))/2}};v.type="WorkflowSnapLayer",c([(0,r.f3)(a.L4)],v.prototype,"document",2),c([(0,r.f3)(x)],v.prototype,"service",2),v=c([(0,r.b2)()],v);var b=(0,o.M1)({onBind({bind:e}){e(x).toSelf().inSingletonScope()},onInit(e,t){let n={...u,...t};e.playground.registerLayer(v,n),e.get(x).init(n)},onDispose(e){e.get(x).dispose()}})},817750:function(e,t,n){n.r(t),n.d(t,{StackingBaseIndex:function(){return b},StackingComputeMode:function(){return L},StackingComputing:function(){return m},StackingConfig:function(){return N},StackingContextManager:function(){return M},StackingItem:function(){return x},StackingType:function(){return v},createFreeStackPlugin:function(){return k},layersComputing:function(){return S}});var o,r,i,a,s,l=n(213153),d=n(362270),h=n(461932),c=n(215206),u=n(682264),g=n(177783),p=Object.defineProperty,f=Object.getOwnPropertyDescriptor,y=(e,t,n,o)=>{for(var r=o>1?void 0:o?f(t,n):t,i,a=e.length-1;a>=0;a--)(i=e[a])&&(r=(o?i(t,n,r):i(r))||r);return o&&r&&p(t,n,r),r},m=class{compute(e){this.clearCache();let{root:t,nodes:n,context:o}=e;return this.context=o,this.nodeIndexes=this.computeNodeIndexesMap(n),this.topLevel=this.computeTopLevel(n),this.maxLevel=2*this.topLevel,this.layerHandler(t.collapsedChildren),{nodeLevel:this.nodeLevel,lineLevel:this.lineLevel,topLevel:this.topLevel,maxLevel:this.maxLevel}}clearCache(){this.currentLevel=0,this.topLevel=0,this.maxLevel=0,this.nodeIndexes=new Map,this.nodeLevel=new Map,this.lineLevel=new Map}computeNodeIndexesMap(e){let t=new Map;return e.forEach((e,n)=>{t.set(e.id,n)}),t}computeTopLevel(e){let t=e.filter(e=>e.id!==c.Sy.ROOT),n=t.reduce((e,t)=>t.collapsedChildren.length>0?e+1:e,0);return t.length+n+1}layerHandler(e,t=!1){let n=e.sort((e,t)=>{let n=this.nodeIndexes.get(e.id),o=this.nodeIndexes.get(t.id);return void 0===n||void 0===o?0:n-o});e.map(e=>{let t=e.getData(u.Z1),n=t.outputLines.filter(Boolean);return[...n,...t.inputLines.filter(Boolean)]}).flat().forEach(e=>{e.isDrawing||this.context.hoveredEntityID===e.id||this.context.selectedIDs.includes(e.id)?this.lineLevel.set(e.id,this.maxLevel):this.lineLevel.set(e.id,this.getLevel(t))}),this.levelIncrease(),n.forEach(e=>{let n=this.context.selectedIDs.includes(e.id);n?this.nodeLevel.set(e.id,this.topLevel):this.nodeLevel.set(e.id,this.getLevel(t)),this.levelIncrease(),e.collapsedChildren.length>0&&this.layerHandler(e.collapsedChildren,t||n)})}getLevel(e){return e?this.topLevel+this.currentLevel:this.currentLevel}levelIncrease(){this.currentLevel+=1}};var x=((o=x||{}).Line="line",o.Node="node",o);var v=((r=v||{}).Line="line",r.Node="node",r),b={line:0,node:1},E=Object.keys(v).length,w=4,N={startIndex:8,allowLevel:2,levelIndexStep:E,maxLevel:w,maxIndex:8+w*E};var L=((i=L||{}).Stacking="stacking",i.Layers="layers",i);(e=>{e.compute=(o,r)=>{let i=t(o,r),a=n(o);a.style.position="absolute",a.style.zIndex=(0,e.zIndexStringify)(i)},e.stackingIndex=(e,t)=>{if(t<1)return;let n=b[e];return N.startIndex+N.levelIndexStep*(t-1)+n},e.nodeStackingLevel=(e,t,n=!1)=>{let o=[],r=e;for(;r;)o.push(r),r=r.parent;let i=o.reverse(),a=i.length-1,s=i.findIndex(e=>!!t.selectedIDs.includes(e.id)||!1),l=N.allowLevel+(i.length-s);return n||-1===s?a:l},e.zIndexStringify=e=>void 0===e?"auto":e.toString();let t=(t,n)=>{let o=(0,e.nodeStackingLevel)(t,n);return(0,e.stackingIndex)("node",o)},n=e=>e.getData(c.Lz).node})(a||(a={})),(e=>{e.compute=(e,t)=>{let o=n(e,t),r=e.node;r.style.position="absolute",r.style.zIndex=a.zIndexStringify(o)};let t=(e,t)=>{if(e.isDrawing||t.hoveredEntityID===e.id||t.selectedIDs.includes(e.id))return N.maxLevel+1;let n=a.nodeStackingLevel(e.from,t,!0);return e.to?Math.min(n,a.nodeStackingLevel(e.to,t,!0)):n},n=(e,n)=>{let o=t(e,n);return a.stackingIndex("line",o)}})(s||(s={}));var S=e=>{let{nodes:t,lines:n,context:o}=e;t.forEach(e=>{a.compute(e,o)}),n.forEach(e=>{s.compute(e,o)})},M=class{constructor(){this.node=g.xF.createDivWithClass("gedit-playground-layer gedit-flow-render-layer"),this.disposers=[],this.mode="stacking",this.compute=(0,d.debounce)(this._compute,10)}init(e){e&&(this.mode=e),this.pipelineRenderer.node.appendChild(this.node),this.mountListener()}ready(){this.compute()}dispose(){this.disposers.forEach(e=>e.dispose())}_compute(){return"stacking"===this.mode?this.stackingCompute():S({nodes:this.nodes,lines:this.lines,context:this.context})}stackingCompute(){let e=this.context,{nodeLevel:t,lineLevel:n}=new m().compute({root:this.document.root,nodes:this.nodes,context:e});this.nodes.forEach(e=>{let n=t.get(e.id),o=e.getData(c.Lz).node;if(o.style.position="absolute",!n){o.style.zIndex="auto";return}o.style.zIndex=String(N.startIndex+n)}),this.lines.forEach(e=>{let t=n.get(e.id),o=e.node;if(o.style.position="absolute",!t){o.style.zIndex="auto";return}o.style.zIndex=String(N.startIndex+t)})}get nodes(){return this.entityManager.getEntities(u.CT)}get lines(){return this.entityManager.getEntities(u.e2)}get context(){return{hoveredEntity:this.hoverService.hoveredNode,hoveredEntityID:this.hoverService.hoveredNode?.id,selectedEntities:this.selectService.selection,selectedIDs:this.selectService.selection.map(e=>e.id)}}mountListener(){let e=this.onEntityChange(),t=this.onZoom(),n=this.onHover(),o=this.onSelect();this.disposers=[e,t,n,o]}onZoom(){return this.pipelineRegistry.onZoom(e=>{this.node.style.transform=`scale(${e})`})}onHover(){return this.hoverService.onHoveredChange(()=>{this.compute()})}onEntityChange(){return this.entityManager.onEntityChange(()=>{this.compute()})}onSelect(){return this.selectService.onSelectionChanged(()=>{this.compute()})}};y([(0,h.f3)(u.L4)],M.prototype,"document",2),y([(0,h.f3)(l.v2)],M.prototype,"entityManager",2),y([(0,h.f3)(l.Tj)],M.prototype,"pipelineRenderer",2),y([(0,h.f3)(l.Rm)],M.prototype,"pipelineRegistry",2),y([(0,h.f3)(u.XH)],M.prototype,"hoverService",2),y([(0,h.f3)(u.oJ)],M.prototype,"selectService",2),M=y([(0,h.b2)()],M);var k=(0,l.M1)({onBind({bind:e}){e(M).toSelf().inSingletonScope()},onInit(e,t){e.get(M).init(t?.mode)},onReady(e){e.get(M).ready()},onDispose(e){e.get(M).dispose()}})}}]);